(()=>{"use strict";var e={211:(e,t,n)=>{var a=n(2299),r=n(6665),l=n(5479),i=n(7114),o=n(5086),s=n(3929),d=n(6283),u=n(6773),c=n(8180),h=n(3668),f=n(530),g=n(1087),m=n(3947);const b=(0,n(8336).createClient)("https://elywhketsxozigeycjkj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVseXdoa2V0c3hvemlnZXljamtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0OTU5MjEsImV4cCI6MjA1NjA3MTkyMX0.oIfd4wPU2UocrmRXIWeCHsofz2rFekWTD5ISMiRAQ70");var x=n(484),p=n(397);const y=h.default.create({header:{height:50,flexDirection:"row",alignItems:"center",backgroundColor:"#fff",borderBottomWidth:1,borderBottomColor:"#ccc",paddingHorizontal:10},sideContainer:{flex:1,alignItems:"center"},centerContainer:{flex:2,alignItems:"center"},logo:{width:80,height:40,resizeMode:"contain"},logoBetrieb:{width:100,height:40,resizeMode:"contain"},title:{fontSize:18,fontWeight:"bold"}}),j=({title:e})=>(0,p.jsxs)(s.default,{style:y.header,children:[(0,p.jsx)(s.default,{style:y.sideContainer,children:(0,p.jsx)(x.default,{source:n(4082),style:y.logo})}),(0,p.jsx)(s.default,{style:y.centerContainer,children:e&&(0,p.jsx)(d.default,{style:y.title,children:e})}),(0,p.jsx)(s.default,{style:y.sideContainer,children:(0,p.jsx)(x.default,{source:n(7635),style:y.logoBetrieb})})]});function k(){const e=(0,m.useNavigation)(),[t,n]=(0,r.useState)(""),[a,l]=(0,r.useState)(""),[i,o]=(0,r.useState)(""),[h,x]=(0,r.useState)(!0);(0,r.useEffect)((()=>{(async()=>{try{const t=await g.default.getItem("lastLogin"),{data:{session:n}}=await b.auth.getSession();if(t&&n){const n=new Date(parseInt(t)),a=new Date;if((a.getTime()-n.getTime())/36e5<24)return void e.replace("Home")}}catch(t){console.error("Fehler beim Pr\xfcfen der gespeicherten Anmeldung:",t)}x(!1)})()}),[]);return h?(0,p.jsxs)(s.default,{style:C.loadingContainer,children:[(0,p.jsx)(f.default,{size:"large",color:"#007AFF"}),(0,p.jsx)(d.default,{children:"Pr\xfcfe Login..."})]}):(0,p.jsxs)(s.default,{style:C.container,children:[(0,p.jsx)(j,{}),(0,p.jsx)(d.default,{style:C.title,children:"Login"}),i?(0,p.jsx)(d.default,{style:C.error,children:i}):null,(0,p.jsx)(u.default,{style:C.input,placeholder:"E-Mail",autoCapitalize:"none",keyboardType:"email-address",value:t,onChangeText:n}),(0,p.jsx)(u.default,{style:C.input,placeholder:"Passwort",secureTextEntry:!0,value:a,onChangeText:l}),(0,p.jsx)(c.default,{title:"Einloggen",onPress:async()=>{o(""),x(!0);try{const{data:n,error:r}=await b.auth.signInWithPassword({email:t,password:a});r||!n.user?(o(r?r.message:"Login fehlgeschlagen"),x(!1)):(await g.default.setItem("lastLogin",Date.now().toString()),e.replace("Home"))}catch(n){o(n.message),x(!1)}},disabled:h})]})}const C=h.default.create({container:{flex:1,padding:20,justifyContent:"center"},title:{fontSize:26,marginBottom:20,textAlign:"center"},error:{color:"red",marginBottom:10,textAlign:"center"},input:{borderWidth:1,borderColor:"#ccc",marginBottom:12,paddingVertical:8,paddingHorizontal:10,borderRadius:6},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center"}});var S=n(2772),z=n(5648),v=n(4754);function w(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function _(e,t){return t.findIndex((t=>w(t.date,e)))}function B(e,t,n,a){const r=n.filter((t=>t.zimmer_id===e.id)).filter((e=>{const n=new Date(e.check_in),a=new Date(e.check_out);return w(t,n)||w(t,a)||t>n&&t<a}));return 0===r.length?(0,p.jsx)(s.default,{style:[T.statusBar,{backgroundColor:"#d3d3d3"}],children:(0,p.jsx)(d.default,{style:T.statusBarText,children:"Frei"})}):(0,p.jsx)(s.default,{style:T.statusBarsContainer,children:r.map((e=>{const n=new Date(e.check_in),r=new Date(e.check_out),l=a.find((t=>t.id===e.gast_id)),i=l?l.nachname:"Unbekannt";let o="";e.verpflegung&&(o="Fr\xfchst\xfcck"===e.verpflegung?"B&B":"Halbpension"===e.verpflegung?"HP":e.verpflegung);let u="",c="";return w(n,r)?(u=`Check-in/Check-out: ${i} (${e.anzahl_personen} P.) [${o}]`,c="#ADD8E6"):w(t,n)?(u=`Check-in: ${i} (${e.anzahl_personen} P.) [${o}]`,c="#ADD8E6"):w(t,r)?(u=`Check-out: ${i} (${e.anzahl_personen} P.) [${o}]`,c="#FFDAB9"):(u=`belegt: ${i} (${e.anzahl_personen} P.) [${o}]`,c="#90EE90"),(0,p.jsx)(s.default,{style:[T.statusBar,{backgroundColor:c}],children:(0,p.jsx)(d.default,{style:T.statusBarText,children:u})},e.id)}))})}const T=h.default.create({container:{flex:1,padding:16,backgroundColor:"#fff"},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:16},dateSelector:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:16},dateText:{fontSize:18,fontWeight:"bold"},navigationButtons:{flexDirection:"row",justifyContent:"space-around",marginBottom:16},roomList:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},roomCard:{width:"48%",backgroundColor:"#f9f9f9",padding:8,marginBottom:16,borderRadius:4,borderWidth:1,borderColor:"#ddd"},roomTitle:{fontSize:16,fontWeight:"bold",marginBottom:4},statusText:{fontSize:14},statusBar:{padding:4,borderRadius:4,marginVertical:2},statusBarText:{fontSize:14,color:"#000"},statusBarsContainer:{flexDirection:"column"},guestName:{color:"blue",textDecorationLine:"underline",marginVertical:2},summary:{marginVertical:16},summaryBorder:{borderTopWidth:1,borderColor:"#ccc",paddingVertical:8},summaryText:{fontSize:16},customModalContainer:{margin:0,justifyContent:"center"},customModalOverlay:{flex:1,backgroundColor:"rgba(0,0,0,0.5)",justifyContent:"center",alignItems:"center",padding:16},customModalContent:{backgroundColor:"#fff",padding:16,borderRadius:8,width:"85%"},modalTitle:{fontSize:18,fontWeight:"bold",marginBottom:12,textAlign:"center"},navFooter:{flexDirection:"row",justifyContent:"space-around",marginTop:16}}),D=()=>{const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)([]),[l,i]=(0,r.useState)([]),[o,u]=(0,r.useState)([]),[h,f]=(0,r.useState)(new Date),[g,x]=(0,r.useState)(""),[y,k]=(0,r.useState)(!1),[C,D]=(0,r.useState)(null),F=(0,r.useRef)(null),P=(0,m.useNavigation)(),I=async()=>{try{const{data:e}=await b.from("zimmer").select("*");e&&a(e);const{data:t}=await b.from("buchungen").select("*");t&&i(t);const{data:n}=await b.from("gaeste").select("*");n&&u(n)}catch(e){console.error("Fehler beim Laden der Daten:",e)}};(0,r.useEffect)((()=>{t(function(){const e=[],t=new Date;t.setDate(t.getDate()-60);const n=new Date;n.setMonth(n.getMonth()+18);let a=new Date(t);for(;a<=n;){const t=a.getDate().toString().padStart(2,"0"),n=a.toLocaleDateString("de-DE",{month:"2-digit",year:"numeric"}).replace(".","/");e.push({date:new Date(a),dayNumber:t,monthYear:n}),a.setDate(a.getDate()+1)}return e}()),I();const e=setInterval(I,12e4);return()=>clearInterval(e)}),[]),(0,r.useEffect)((()=>{if(e.length>0&&F.current){const t=_(new Date,e);if(-1!==t){const e=80+60*t;F.current?.scrollTo({x:e,animated:!1})}}}),[e]);const O=e=>{const t=new Date(h);t.setDate(t.getDate()+e),f(t)},E=e=>{D(e),k(!0)},N=()=>{P.navigate("Calendarscreen")},A=()=>{P.navigate("AnzahlungenScreen")},M=()=>{P.navigate("EinstellungenScreen")};return(0,p.jsxs)(S.default,{style:T.container,children:[(0,p.jsx)(j,{}),(0,p.jsx)(d.default,{style:T.title,children:"Tages\xfcbersicht"}),(0,p.jsxs)(s.default,{style:T.dateSelector,children:[(0,p.jsx)(c.default,{title:"\u2039",onPress:()=>O(-1)}),(0,p.jsx)(d.default,{style:T.dateText,children:(R=h,`${R.getDate().toString().padStart(2,"0")}.${(R.getMonth()+1).toString().padStart(2,"0")}.${R.getFullYear()}`)}),(0,p.jsx)(c.default,{title:"\u203a",onPress:()=>O(1)})]}),(0,p.jsxs)(s.default,{style:T.navigationButtons,children:[(0,p.jsx)(c.default,{title:"Zum Kalender",onPress:N}),(0,p.jsx)(c.default,{title:"Anzahlungen",onPress:A}),(0,p.jsx)(c.default,{title:"Einstellungen",onPress:M})]}),(0,p.jsx)(s.default,{style:T.roomList,children:n.map((e=>(0,p.jsxs)(s.default,{style:T.roomCard,children:[(0,p.jsxs)(d.default,{style:T.roomTitle,children:["Zimmer ",e.nummer]}),B(e,h,l,o)]},e.id)))}),(0,p.jsxs)(s.default,{style:T.summary,children:[(0,p.jsx)(s.default,{style:T.summaryBorder,children:(0,p.jsxs)(d.default,{style:T.summaryText,children:["Fr\xfchst\xfcck (B&B):"," ",l.filter((e=>("Fr\xfchst\xfcck"===e.verpflegung||"Halbpension"===e.verpflegung)&&new Date(e.check_in)<=h&&new Date(e.check_out)>=h)).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]})}),(0,p.jsx)(s.default,{style:T.summaryBorder,children:(0,p.jsxs)(d.default,{style:T.summaryText,children:["Halbpension (HP):"," ",l.filter((e=>"Halbpension"===e.verpflegung&&new Date(e.check_in)<=h&&new Date(e.check_out)>=h)).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]})}),(0,p.jsxs)(s.default,{style:T.summaryBorder,children:[(0,p.jsxs)(d.default,{style:T.summaryText,children:["Check-Ins:"," ",l.filter((e=>w(new Date(e.check_in),h))).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]}),l.filter((e=>w(new Date(e.check_in),h))).map(((e,t)=>{const a=o.find((t=>t.id===e.gast_id)),r=n.find((t=>t.id===e.zimmer_id))?.nummer||"";return(0,p.jsx)(z.default,{onPress:()=>E(e),children:(0,p.jsxs)(d.default,{style:T.guestName,children:["Zimmer ",r," - ",a?`${a.vorname} ${a.nachname}`:"Unbekannt"]})},`in-${t}`)}))]}),(0,p.jsxs)(s.default,{style:T.summaryBorder,children:[(0,p.jsxs)(d.default,{style:T.summaryText,children:["Check-Outs:"," ",l.filter((e=>w(new Date(e.check_out),h))).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]}),l.filter((e=>w(new Date(e.check_out),h))).map(((e,t)=>{const a=o.find((t=>t.id===e.gast_id)),r=n.find((t=>t.id===e.zimmer_id))?.nummer||"";return(0,p.jsx)(z.default,{onPress:()=>E(e),children:(0,p.jsxs)(d.default,{style:T.guestName,children:["Zimmer ",r," - ",a?`${a.vorname} ${a.nachname}`:"Unbekannt"]})},`out-${t}`)}))]}),(0,p.jsxs)(s.default,{style:T.summaryBorder,children:[(0,p.jsx)(d.default,{style:T.summaryText,children:"Anwesende G\xe4ste:"}),l.filter((e=>h>new Date(e.check_in)&&h<new Date(e.check_out))).map(((e,t)=>{const a=o.find((t=>t.id===e.gast_id)),r=n.find((t=>t.id===e.zimmer_id))?.nummer||"";return(0,p.jsx)(z.default,{onPress:()=>E(e),children:(0,p.jsxs)(d.default,{style:T.guestName,children:["Zimmer ",r," - ",a?`${a.vorname} ${a.nachname}`:"Unbekannt"]})},`active-${t}`)}))]})]}),C&&(0,p.jsx)(v.default,{isVisible:y,onBackdropPress:()=>k(!1),useNativeDriver:!1,style:T.customModalContainer,children:(0,p.jsx)(s.default,{style:T.customModalOverlay,children:(0,p.jsxs)(s.default,{style:T.customModalContent,children:[(0,p.jsx)(d.default,{style:T.modalTitle,children:"Buchungsdetails"}),(0,p.jsxs)(d.default,{children:["Zimmer:"," ",n.find((e=>e.id===C.zimmer_id))?.nummer]}),(0,p.jsxs)(d.default,{children:["Check-In: ",C.check_in]}),(0,p.jsxs)(d.default,{children:["Check-Out: ",C.check_out]}),(0,p.jsxs)(d.default,{children:["Gast:"," ",(()=>{const e=o.find((e=>e.id===C.gast_id));return e?`${e.vorname} ${e.nachname}`:"Unbekannt"})()]}),(0,p.jsxs)(d.default,{children:["Personen: ",C.anzahl_personen]}),(0,p.jsxs)(d.default,{children:["Status: ",C.status]}),(0,p.jsxs)(d.default,{children:["Verpflegung: ",C.verpflegung||"-"]}),(0,p.jsxs)(d.default,{children:["Anzahlung: ",C.anzahlung]}),(0,p.jsxs)(d.default,{children:["Preis pro Person: ",C.preis_pro_person]}),(0,p.jsxs)(d.default,{children:["Zusatz Preis: ",C.zusatz_preis]}),(0,p.jsxs)(d.default,{children:["Tel.: / email: ",C.tel_email]}),(0,p.jsxs)(d.default,{children:["Notiz: ",C.notiz||"-"]}),(0,p.jsx)(c.default,{title:"Schlie\xdfen",onPress:()=>k(!1)})]})})}),(0,p.jsxs)(s.default,{style:T.navFooter,children:[(0,p.jsx)(c.default,{title:"Zum Kalender",onPress:N}),(0,p.jsx)(c.default,{title:"Anzahlungen",onPress:A}),(0,p.jsx)(c.default,{title:"Einstellungen",onPress:M})]})]});var R};var F=n(1690),P=n(6725),I=n(2365),O=n(1950);function E(e,t){window.alert(`${e}: ${t}`)}const N=(0,r.memo)((({options:e,selectedValue:t,onChange:n})=>(0,p.jsx)(s.default,{style:W.radioGroup,children:e.map((e=>{const a=e.value===t;return(0,p.jsx)(O.default,{onPress:()=>n(e.value),children:(0,p.jsx)(s.default,{style:[W.radioOption,a&&W.radioOptionSelected],children:(0,p.jsx)(d.default,{style:[W.radioLabel,a&&W.radioLabelSelected],children:e.label})})},e.value)}))}))),A=[{label:"Belegt",value:"belegt"},{label:"Anzahlung",value:"anzahlung"},{label:"Anz. bez",value:"anzahlung_bezahlt"}],M=[{label:"Fr\xfchst\xfcck",value:"Fr\xfchst\xfcck"},{label:"Halbpension",value:"Halbpension"}],R=[{label:"Nein",value:"nein"},{label:"Ja",value:"ja"}],W=h.default.create({modalContainer:{margin:0,justifyContent:"flex-end"},scrollContainer:{flexGrow:1,justifyContent:"center"},modalOverlay:{flexGrow:1,backgroundColor:"rgba(0,0,0,0.5)",padding:16,justifyContent:"center"},modalContent:{backgroundColor:"#fff",borderRadius:8,padding:16,width:"85%",alignSelf:"center"},modalTitle:{fontSize:18,fontWeight:"bold",marginBottom:12,textAlign:"center"},label:{marginTop:8,fontWeight:"600",marginBottom:4,fontSize:16},input:{height:40,fontSize:16,paddingVertical:8,paddingHorizontal:10,borderWidth:1,borderColor:"#ccc",borderRadius:4,color:"black",marginBottom:12},radioGroup:{flexDirection:"row",marginBottom:12},radioOption:{paddingVertical:4,paddingHorizontal:8,borderWidth:1,borderColor:"#ccc",borderRadius:4,marginRight:8},radioOptionSelected:{backgroundColor:"#007AFF",borderColor:"#007AFF"},radioLabel:{fontSize:16,color:"black"},radioLabelSelected:{color:"#fff"},buttonRow:{flexDirection:"row",justifyContent:"space-around",marginTop:12}}),$=(0,r.memo)((({isVisible:e,checkIn:t,checkOut:n,onClose:a,onSubmit:l,onRefresh:i,initialGuestName:o="",initialPersonCount:h=0,selectedRoomId:f})=>{const[g,m]=(0,r.useState)(o),[x,y]=(0,r.useState)(h.toString()),[j,k]=(0,r.useState)("belegt"),[C,z]=(0,r.useState)("0"),[w,_]=(0,r.useState)("Fr\xfchst\xfcck"),[B,T]=(0,r.useState)(""),[D,F]=(0,r.useState)("nein"),[P,O]=(0,r.useState)(""),[$,L]=(0,r.useState)(""),[V,Y]=(0,r.useState)(""),[H,G]=(0,r.useState)(!1);(0,r.useEffect)((()=>{e&&(m(o),y(h.toString()),k("belegt"),z("0"),_("Fr\xfchst\xfcck"),T(""),F("nein"),O(""),L(""),Y(""),G(!1))}),[e,o,h]),(0,r.useEffect)((()=>{""!==C.trim()&&"0"!==C&&k("anzahlung")}),[C]);const Z=g.trim().split(" ").length>=2&&!isNaN(parseInt(x))&&parseInt(x)>0,q=(0,r.useCallback)((async(e,t,n)=>{const{data:a,error:r}=await b.from("buchungen").select("id").eq("zimmer_id",e).is("deleted_at",null).filter("check_in","lt",n).filter("check_out","gt",t);return r?(E("Fehler","Fehler bei der Verf\xfcgbarkeitspr\xfcfung."),!1):a&&0===a.length}),[]),U=(0,r.useCallback)((async()=>{if(H)return;if(!f)return void E("Fehler","Kein Zimmer ausgew\xe4hlt.");const e=parseInt(x);if(isNaN(e)||e<=0)E("Fehler","Bitte eine g\xfcltige Anzahl an Personen eingeben.");else{G(!0);try{const r=parseFloat(C),l=""===B.trim()?null:parseFloat(B),o=P.trim();console.log("Submitting booking with data:",{guestName:g,personCount:e,status:j,anzahlung:isNaN(r)?0:r,verpflegung:w,preisProPerson:l,hund:"ja"===D,zusatzPreis:o,notiz:V,tel_email:$});const s=g.trim().split(" ");if(s.length<2)return E("Fehler","Bitte Vor- und Nachname eingeben."),void G(!1);let d=null;const{data:u,error:c}=await b.from("gaeste").select("id").eq("vorname",s[0]).eq("nachname",s[1]);if(c&&console.log("Fehler bei der Gast-Suche",c),u&&u.length>0)d=u[0].id;else{const{data:e}=await b.from("gaeste").insert([{vorname:s[0],nachname:s[1]}]).select("*").single();if(!e)return E("Fehler","Gast konnte nicht erstellt werden."),void G(!1);d=e.id}if(!await q(f,t,n))return E("Fehler","Das Zimmer ist im angegebenen Zeitraum bereits vergeben."),void G(!1);const{error:h}=await b.from("buchungen").insert([{zimmer_id:f,gast_id:d,check_in:t,check_out:n,anzahl_personen:e,preis_pro_person:l??0,anzahlung:isNaN(r)?0:r,status:j,verpflegung:w,hund:"ja"===D,zusatz_preis:o,tel_email:$,notiz:V}]);h?E("Fehler",h.message):(E("Erfolg","Buchung erstellt!"),a(),i&&await i())}catch(r){console.error("Fehler beim Erstellen der Buchung:",r),E("Fehler",r.message||"Unbekannter Fehler beim Erstellen der Buchung.")}G(!1)}}),[H,x,C,B,P,g,j,w,D,$,V,t,n,f,a,i,q]),K=(0,p.jsx)(S.default,{contentContainerStyle:W.scrollContainer,keyboardShouldPersistTaps:"handled",keyboardDismissMode:"on-drag",children:(0,p.jsx)(s.default,{style:W.modalOverlay,children:(0,p.jsxs)(s.default,{style:W.modalContent,children:[(0,p.jsx)(d.default,{style:W.modalTitle,children:"Neue Buchung"}),(0,p.jsxs)(d.default,{children:["Check-In: ",t]}),(0,p.jsxs)(d.default,{children:["Check-Out: ",n]}),(0,p.jsx)(d.default,{style:W.label,children:"Gastname:"}),(0,p.jsx)(u.default,{style:W.input,placeholder:"Vorname Nachname",value:g,onChangeText:m,returnKeyType:"done",onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:W.label,children:"Personenanzahl:"}),(0,p.jsx)(u.default,{style:W.input,placeholder:"z. B. 2",value:x,onChangeText:y,keyboardType:"numeric",returnKeyType:"done",onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:W.label,children:"Status:"}),(0,p.jsx)(N,{options:A,selectedValue:j,onChange:k}),(0,p.jsx)(d.default,{style:W.label,children:"Anzahlung:"}),(0,p.jsx)(u.default,{style:W.input,placeholder:"0",value:C,onChangeText:z,keyboardType:"numeric",returnKeyType:"done",onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:W.label,children:"Verpflegung:"}),(0,p.jsx)(N,{options:M,selectedValue:w,onChange:_}),(0,p.jsx)(d.default,{style:W.label,children:"Preis pro Person:"}),(0,p.jsx)(u.default,{style:W.input,placeholder:"z. B. 50",value:B,onChangeText:T,keyboardType:"numeric",returnKeyType:"done",onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:W.label,children:"Hund:"}),(0,p.jsx)(N,{options:R,selectedValue:D,onChange:F}),(0,p.jsx)(d.default,{style:W.label,children:"Zusatz Preis:"}),(0,p.jsx)(u.default,{style:W.input,placeholder:"z. B. 10",value:P,onChangeText:O,returnKeyType:"done",onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:W.label,children:"Tel.: / email:"}),(0,p.jsx)(u.default,{style:W.input,placeholder:"Telefon oder Email",value:$,onChangeText:L,returnKeyType:"done",onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:W.label,children:"Notiz:"}),(0,p.jsx)(u.default,{style:[W.input,{height:80}],placeholder:"Notiz",value:V,onChangeText:Y,multiline:!0,returnKeyType:"done"}),(0,p.jsxs)(s.default,{style:W.buttonRow,children:[(0,p.jsx)(c.default,{title:"Abbrechen",onPress:a}),""!==t.trim()&&""!==n.trim()&&(0,p.jsx)(c.default,{title:"Buchung erstellen",disabled:!Z||H,onPress:U})]})]})})});return(0,p.jsx)(v.default,{isVisible:e,onBackdropPress:a,coverScreen:!0,useNativeDriver:!1,style:W.modalContainer,propagateSwipe:!0,avoidKeyboard:!0,children:K})}));function L(e,t){window.alert(`${e}: ${t}`)}const V=(0,r.memo)((({options:e,selectedValue:t,onChange:n})=>(0,p.jsx)(s.default,{style:H.radioGroup,children:e.map((e=>{const a=e.value===t;return(0,p.jsx)(O.default,{onPress:()=>n(e.value),children:(0,p.jsx)(s.default,{style:[H.radioOption,a&&H.radioOptionSelected],children:(0,p.jsx)(d.default,{style:[H.radioLabel,a&&H.radioLabelSelected],children:e.label})})},e.value)}))}))),Y={height:40,fontSize:16,paddingVertical:8,paddingHorizontal:10,borderWidth:1,borderColor:"#ccc",borderRadius:4,color:"black",marginBottom:12,width:"100%"},H=h.default.create({modalContainer:{margin:0,justifyContent:"flex-end"},scrollContainer:{flexGrow:1,justifyContent:"center"},modalOverlay:{flexGrow:1,backgroundColor:"rgba(0,0,0,0.5)",padding:16,justifyContent:"center"},modalContent:{backgroundColor:"#fff",borderRadius:8,padding:16,width:"85%",alignSelf:"center"},modalTitle:{fontSize:18,fontWeight:"bold",marginBottom:12,textAlign:"center"},label:{marginTop:8,fontWeight:"600",marginBottom:4,fontSize:16},radioGroup:{flexDirection:"row",marginBottom:12},radioOption:{paddingVertical:4,paddingHorizontal:8,borderWidth:1,borderColor:"#ccc",borderRadius:4,marginRight:8},radioOptionSelected:{backgroundColor:"#007AFF",borderColor:"#007AFF"},radioLabel:{fontSize:16,color:"black"},radioLabelSelected:{color:"#fff"},buttonRow:{flexDirection:"row",justifyContent:"space-around",marginTop:12},modalButtons:{marginTop:12,alignItems:"center"}}),G=(0,r.memo)((({isVisible:e,booking:t,onClose:n,onUpdate:a,onDelete:l,onRefresh:i})=>{const[o,h]=(0,r.useState)(t.guestName),[f,g]=(0,r.useState)(t.personCount.toString()),[m,x]=(0,r.useState)(t.status),[y,j]=(0,r.useState)(t.anzahlung.toString()),[k,C]=(0,r.useState)(t.verpflegung||"Fr\xfchst\xfcck"),[z,w]=(0,r.useState)(null!==t.preisProPerson?t.preisProPerson.toString():""),[_,B]=(0,r.useState)(t.hund?"ja":"nein"),[T,D]=(0,r.useState)(t.zusatz_preis),[F,P]=(0,r.useState)(t.tel_email),[O,E]=(0,r.useState)(t.zimmerNumber),[N,A]=(0,r.useState)(t.checkIn),[M,R]=(0,r.useState)(t.checkOut),[W,$]=(0,r.useState)(t.notiz||""),[G,Z]=(0,r.useState)(!1);(0,r.useEffect)((()=>{h(t.guestName),g(t.personCount.toString()),x(t.status),j(t.anzahlung.toString()),C(t.verpflegung||"Fr\xfchst\xfcck"),w(null!==t.preisProPerson?t.preisProPerson.toString():""),B(t.hund?"ja":"nein"),D(t.zusatz_preis),P(t.tel_email),E(t.zimmerNumber),A(t.checkIn),R(t.checkOut),$(t.notiz||""),Z(!1)}),[t]);const q=o.trim().split(" ").length>=2&&!isNaN(parseInt(f))&&parseInt(f)>0&&""!==N.trim()&&""!==M.trim()&&""!==O.trim(),U=(0,r.useCallback)((async()=>{if(G)return;const e=parseInt(f);if(isNaN(e)||e<=0)return void L("Fehler","Bitte eine g\xfcltige Anzahl an Personen eingeben.");Z(!0);const a=parseFloat(y),r=""===z.trim()?null:parseFloat(z);if(!O.trim())return L("Fehler","Bitte eine Zimmernummer angeben."),void Z(!1);const{error:l}=await b.from("buchungen").update({check_in:N,check_out:M,anzahl_personen:e,preis_pro_person:r??0,anzahlung:isNaN(a)?0:a,status:m,verpflegung:k,hund:"ja"===_,zusatz_preis:T,tel_email:F,notiz:W}).eq("id",t.id);l?L("Fehler",l.message):(L("Erfolg","Buchung aktualisiert!"),i&&await i(),n()),Z(!1)}),[G,f,y,z,O,N,M,m,k,_,T,F,W,t.id,i,n]),K=(0,r.useCallback)((async()=>{if(G)return;if(await async function(e){return Promise.resolve(window.confirm(e))}("M\xf6chtest du die Buchung wirklich l\xf6schen?")){Z(!0);const{error:e}=await b.from("buchungen").update({deleted_at:(new Date).toISOString()}).eq("id",t.id);e?L("Fehler",e.message):(L("Erfolg","Buchung wurde soft-deleted!"),i&&await i(),n()),Z(!1)}}),[G,t.id,i,n]),J=(0,p.jsx)(S.default,{contentContainerStyle:H.scrollContainer,keyboardShouldPersistTaps:"handled",keyboardDismissMode:"on-drag",children:(0,p.jsx)(s.default,{style:H.modalOverlay,children:(0,p.jsxs)(s.default,{style:H.modalContent,children:[(0,p.jsx)(d.default,{style:H.modalTitle,children:"Buchung bearbeiten"}),(0,p.jsxs)(d.default,{children:["Aktueller Check-In: ",t.checkIn]}),(0,p.jsxs)(d.default,{children:["Aktueller Check-Out: ",t.checkOut]}),(0,p.jsx)(d.default,{style:H.label,children:"Zimmernummer:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 101",value:O,onChangeText:E,blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Neuer Check-In:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"YYYY-MM-DD",value:N,onChangeText:A,blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Neuer Check-Out:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"YYYY-MM-DD",value:M,onChangeText:R,blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Gastname:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"Vorname Nachname",value:o,onChangeText:h,blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Anzahl Personen:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 2",value:f,onChangeText:g,keyboardType:"numeric",blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Status:"}),(0,p.jsx)(V,{options:[{label:"Belegt",value:"belegt"},{label:"Anzahlung",value:"anzahlung"},{label:"Anz. bez",value:"anzahlung_bezahlt"}],selectedValue:m,onChange:x}),(0,p.jsx)(d.default,{style:H.label,children:"Anzahlung:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"0",value:y,onChangeText:j,keyboardType:"numeric",blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Verpflegung:"}),(0,p.jsx)(V,{options:[{label:"Fr\xfchst\xfcck",value:"Fr\xfchst\xfcck"},{label:"Halbpension",value:"Halbpension"}],selectedValue:k,onChange:C}),(0,p.jsx)(d.default,{style:H.label,children:"Preis pro Person:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 50",value:z,onChangeText:w,keyboardType:"numeric",blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Hund:"}),(0,p.jsx)(V,{options:[{label:"Nein",value:"nein"},{label:"Ja",value:"ja"}],selectedValue:_,onChange:B}),(0,p.jsx)(d.default,{style:H.label,children:"Zusatz Preis:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 10",value:T,onChangeText:D,blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Tel.: / email:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"Telefon oder Email",value:F,onChangeText:P,blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsx)(d.default,{style:H.label,children:"Notiz:"}),(0,p.jsx)(u.default,{style:[Y,{height:80}],placeholder:"Notiz",value:W,onChangeText:$,multiline:!0,blurOnSubmit:!0,onSubmitEditing:I.default.dismiss}),(0,p.jsxs)(s.default,{style:H.buttonRow,children:[(0,p.jsx)(c.default,{title:"Aktualisieren",disabled:!q||G,onPress:U}),(0,p.jsx)(c.default,{title:"L\xf6schen",color:"red",onPress:K,disabled:G})]}),(0,p.jsx)(s.default,{style:H.modalButtons,children:(0,p.jsx)(c.default,{title:"Schlie\xdfen",onPress:n,disabled:G})})]})})});return(0,p.jsx)(v.default,{isVisible:e,onBackdropPress:n,coverScreen:!0,useNativeDriver:!1,style:H.modalContainer,propagateSwipe:!0,avoidKeyboard:!0,children:J})})),Z=60,{width:q}=P.default.get("window"),U=q<400;function K(e){return e.includes("T")?new Date(e):new Date(e+"T00:00:00")}function J(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function X(e,t){return t.findIndex((t=>J(t.date,e)))}function Q(e){const t=e.getDate().toString().padStart(2,"0"),n=e.toLocaleDateString("de-DE",{month:"2-digit",year:"numeric"}).replace(".","/");return{date:new Date(e),dayNumber:t,monthYear:n}}function ee(e,t,n,a){if(!e)return!1;if(t.getTime()===n.getTime())return!0;for(const r of a){if(r.zimmer_id!==e)continue;const a=K(r.check_in),l=K(r.check_out);if(t<l&&n>a){if(n.getTime()===a.getTime()||t.getTime()===l.getTime())continue;return!1}}return!0}function te(e,t,n){return n.find((n=>{if(n.zimmer_id!==t)return!1;const a=K(n.check_in),r=K(n.check_out);return e.date>=a&&e.date<=r}))||null}const ne=r.memo((({day:e,isSelected:t,existingBooking:n,onPress:a})=>(0,p.jsx)(z.default,{style:[le.dayCell,{width:Z,height:35},n&&{backgroundColor:"transparent"},t&&le.selectedDayCell],onPress:a,children:(0,p.jsx)(d.default,{style:le.dayCellText,children:e.dayNumber})}))),ae=r.memo((e=>{const{zimmer:t,bookings:n,daysArray:a,gaeste:r,onPressBooking:l,highlightedBookingId:i}=e;return(0,p.jsx)(s.default,{style:le.overlayContainer,children:n.map((e=>{const t=K(e.check_in),n=K(e.check_out),o=X(t,a),u=X(n,a);if(o<0||u<0)return null;let c=o*Z,h=(u-o+1)*Z;o===u?(c+=30,h=30):(c+=30,h-=Z);const f=r.find((t=>t.id===e.gast_id)),g=f?`${f.vorname} ${f.nachname}`:"Unbekannt";let m="";"Fr\xfchst\xfcck"===e.verpflegung?m="B&B":"Halbpension"===e.verpflegung?m="HP":e.verpflegung&&(m=e.verpflegung);const b=`${g} (${e.anzahl_personen}P) ${m}`;let x="#ccffcc";return"belegt"===e.status?x="#ffcccc":"anzahlung"===e.status?x="#ffffcc":"booking"===e.status&&(x="#ccccff"),(0,p.jsx)(z.default,{activeOpacity:.8,onPress:()=>l(e),children:(0,p.jsx)(s.default,{style:[le.bookingBlock,{left:c,width:h,backgroundColor:x},i===e.id&&{borderWidth:3,borderColor:"black"}],children:(0,p.jsx)(d.default,{style:le.bookingBlockText,numberOfLines:2,children:b})})},e.id)}))})}));function re({buchungen:e,onRefresh:t}){const[n,a]=(0,r.useState)([]),[l,i]=(0,r.useState)(10),[o,h]=(0,r.useState)(6),[f,g]=(0,r.useState)([]),[x,y]=(0,r.useState)([]),[k,C]=(0,r.useState)(null),[v,w]=(0,r.useState)(null),[_,B]=(0,r.useState)(null),[T,D]=(0,r.useState)(null),[P,I]=(0,r.useState)(0),[O,E]=(0,r.useState)(!1),[N,A]=(0,r.useState)(!1),[M,R]=(0,r.useState)(null),[W,L]=(0,r.useState)(""),[V,Y]=(0,r.useState)(""),[H,q]=(0,r.useState)(""),[re,ie]=(0,r.useState)(new Date),oe=(0,r.useRef)(null),se=(0,r.useRef)(0),de=(0,r.useMemo)((()=>function(e,t){const n=new Date;n.setDate(n.getDate()-e);const a=new Date;a.setMonth(a.getMonth()+t);const r=[];let l=new Date(n);for(;l<=a;)r.push(Q(l)),l.setDate(l.getDate()+1);return r}(l,o)),[l,o]),ue=(0,r.useCallback)((async()=>{try{const{data:e}=await b.from("zimmer").select("*");e&&g(e);const{data:t}=await b.from("gaeste").select("*").is("deleted_at",null);t&&y(t)}catch(e){console.error("Fehler beim Laden von Zimmern/G\xe4sten:",e)}}),[]);(0,r.useEffect)((()=>{ue();const e=setInterval(ue,45e3);return()=>clearInterval(e)}),[ue]),(0,r.useEffect)((()=>{a(e.filter((e=>!e.deleted_at)))}),[e]),(0,m.useFocusEffect)((0,r.useCallback)((()=>{const e=Date.now();e-se.current>45e3&&(t(),se.current=e)}),[t]));const ce=(0,r.useCallback)((e=>{const t=e.nativeEvent.contentOffset.x+e.nativeEvent.layoutMeasurement.width/2,n=Math.floor(t/Z);if(n>=0&&n<de.length){const e=de[n].date;e.getMonth()===re.getMonth()&&e.getFullYear()===re.getFullYear()||ie(e)}}),[de,re]),he=(0,r.useCallback)((e=>{if(0===de.length||!oe.current)return;const t=de.findIndex((t=>t.date.getFullYear()===e.getFullYear()&&t.date.getMonth()===e.getMonth()));if(-1!==t){const e=80+t*Z;oe.current.scrollTo({x:e,animated:!0})}}),[de]),fe=(0,r.useCallback)((e=>{const t=re.getFullYear(),n=new Date(t,e,1);ie(n),he(n)}),[re,he]),ge=(0,r.useCallback)((()=>i((e=>e+90))),[]),me=(0,r.useCallback)((()=>h((e=>e+3))),[]),be=(0,r.useCallback)(((e,t)=>{if(!k){if(!ee(t,e.date,e.date,n))return;return B(t),C(e),void w(e)}if(_!==t){if(!ee(t,e.date,e.date,n))return;return B(t),C(e),void w(e)}if(J(e.date,k.date))w(e);else{if(e.date>=k.date){const a=ee(t,k.date,e.date,n),r=te(e,t,n);return a||r&&J(e.date,K(r.check_in))?void w(e):void F.default.alert("Das Intervall ist nicht verf\xfcgbar.")}C(e),w(e)}}),[k,n,_]),xe=(0,r.useCallback)((()=>{if(!H.trim())return;const e=H.toLowerCase(),t=n.filter((t=>{const n=x.find((e=>e.id===t.gast_id));if(!n)return!1;return`${n.vorname} ${n.nachname}`.toLowerCase().includes(e)})).map((e=>e.id));if(t.length>0){const e=t[P%t.length];D(e),I(P+1);const a=n.find((t=>t.id===e));if(a){const e=X(K(a.check_in),de);if(-1!==e&&oe.current){const t=80+e*Z;oe.current.scrollTo({x:t,animated:!0})}}}else D(null),I(0)}),[H,n,x,de,P]),pe=(0,r.useCallback)((()=>{k&&v&&null!==_?J(k.date,v.date)?F.default.alert("Bitte w\xe4hlen Sie unterschiedliche Tage f\xfcr Check\u2011In und Check\u2011Out aus."):E(!0):F.default.alert("Bitte Check\u2011In und Check\u2011Out ausw\xe4hlen.")}),[k,v,_]),ye=(0,r.useCallback)((e=>{const t=x.find((t=>t.id===e.gast_id)),n={id:e.id,zimmer_id:e.zimmer_id,guestName:t?`${t.vorname} ${t.nachname}`:"Unbekannt",personCount:e.anzahl_personen,checkIn:e.check_in,checkOut:e.check_out,status:e.status,anzahlung:e.anzahlung,verpflegung:e.verpflegung||"",preisProPerson:e.preis_pro_person,hund:e.hund||!1,zusatz_preis:e.zusatz_preis,tel_email:e.tel_email,notiz:e.notiz||"",zimmerNumber:f.find((t=>t.id===e.zimmer_id))?.nummer||""};R(n),A(!0)}),[x,f]),je=(0,r.useCallback)((async e=>{if(!k||!v||null===_)return void F.default.alert("Fehler","Bitte Check\u2011In, Check\u2011Out und Zimmer ausw\xe4hlen.");const n=k.date.toISOString().split("T")[0],a=v.date.toISOString().split("T")[0],r=e.guestName.trim().split(" ");if(r.length<2)return void F.default.alert("Fehler","Bitte Vor\u2011 und Nachname eingeben.");let l=null;const{data:i}=await b.from("gaeste").select("id, vorname, nachname").eq("vorname",r[0]).eq("nachname",r[1]);if(i&&i.length>0)l=i[0].id;else{const{data:e,error:t}=await b.from("gaeste").insert([{vorname:r[0],nachname:r[1]}]).select("*").single();if(t||!e)return void F.default.alert("Fehler","Gast konnte nicht erstellt werden.");l=e.id}const{data:o,error:s}=await b.from("buchungen").insert([{zimmer_id:_,gast_id:l,check_in:n,check_out:a,anzahl_personen:e.personCount,preis_pro_person:e.preisProPerson??0,anzahlung:e.anzahlung,status:e.status,verpflegung:e.verpflegung,hund:e.hund,zusatz_preis:e.zusatzPreis,tel_email:e.tel_email,notiz:e.notiz}]).select("*").single();!s&&o?(F.default.alert("Erfolg","Buchung erstellt!"),B(null),C(null),w(null),setTimeout((()=>{t(),ue()}),200)):F.default.alert("Fehler",s?.message||"Buchung konnte nicht erstellt werden.")}),[k,v,_,t,ue]),ke=(0,r.useCallback)((async e=>{await t(),await ue(),A(!1),R(null)}),[t,ue]),Ce=(0,r.useCallback)((async e=>{const{error:n}=await b.from("buchungen").update({deleted_at:(new Date).toISOString()}).eq("id",e);n?F.default.alert("Fehler",n.message):(F.default.alert("Erfolg","Buchung wurde soft-deleted!"),await t(),await ue(),A(!1),R(null))}),[t,ue]);return(0,p.jsxs)(s.default,{style:le.container,children:[(0,p.jsx)(j,{title:"Zimmer-Kalender"}),(0,p.jsxs)(s.default,{style:le.controlsContainer,children:[(0,p.jsx)(c.default,{title:"-3 Monate",onPress:ge}),(0,p.jsx)(d.default,{style:le.monthYearText,children:re.toLocaleDateString("de-DE",{month:"long",year:"numeric"})}),(0,p.jsx)(c.default,{title:"+3 Monate",onPress:me})]}),(0,p.jsx)(s.default,{style:le.monthButtonsContainer,children:["Jan","Feb","M\xe4r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"].map(((e,t)=>(0,p.jsx)(z.default,{style:le.monthButton,onPress:()=>fe(t),children:(0,p.jsx)(d.default,{style:le.monthButtonText,children:U?e.substring(0,2):e})},t)))}),(0,p.jsxs)(s.default,{style:le.tableContainer,children:[(0,p.jsxs)(s.default,{style:le.fixedColumn,children:[(0,p.jsx)(s.default,{style:[le.headerCell,le.leftHeaderCell],children:(0,p.jsx)(d.default,{style:le.headerCellText,children:"Zimmer"})}),f.map((e=>(0,p.jsx)(s.default,{style:le.zimmerCell,children:(0,p.jsxs)(d.default,{style:le.zimmerText,children:["Z. ",e.nummer]})},e.id)))]}),(0,p.jsx)(S.default,{horizontal:!0,style:le.horizontalScroll,ref:oe,onScroll:ce,scrollEventThrottle:16,children:(0,p.jsxs)(s.default,{children:[(0,p.jsx)(s.default,{style:le.headerRow,children:de.map((e=>{const t=J(e.date,new Date),n=e.date.toLocaleDateString("de-DE",{weekday:"short"}),a=n.startsWith("Sa")||n.startsWith("So");return(0,p.jsxs)(s.default,{style:[le.headerCell,{width:Z},t&&le.todayHeader,a&&le.weekendHeader],children:[(0,p.jsxs)(d.default,{style:le.headerSmallText,children:[n," ",e.monthYear]}),(0,p.jsx)(d.default,{style:le.headerDayNumber,children:e.dayNumber})]},e.date.toISOString())}))}),f.map((e=>(0,p.jsxs)(s.default,{style:{position:"relative",height:35},children:[(0,p.jsx)(s.default,{style:le.zimmerRow,children:de.map((t=>{const a=_===e.id&&(k&&J(t.date,k.date)||v&&J(t.date,v.date)),r=te(t,e.id,n);return(0,p.jsx)(ne,{day:t,isSelected:a,existingBooking:r,onPress:()=>{k?be(t,e.id):r||be(t,e.id)}},t.date.toISOString())}))}),(0,p.jsx)(ae,{zimmer:e,bookings:n.filter((t=>t.zimmer_id===e.id)),daysArray:de,gaeste:x,onPressBooking:ye,highlightedBookingId:T})]},e.id)))]})})]}),(0,p.jsxs)(s.default,{style:le.searchContainer,children:[(0,p.jsx)(u.default,{style:le.searchInput,placeholder:"Nach Gastname suchen...",value:H,onChangeText:q}),(0,p.jsx)(c.default,{title:"Suchen",onPress:xe})]}),k&&v&&!J(k.date,v.date)&&(0,p.jsx)(z.default,{style:le.bookingButton,onPress:pe,children:(0,p.jsx)(d.default,{style:le.bookingButtonText,children:"Buchungsformular \xf6ffnen"})}),(0,p.jsx)($,{isVisible:O,checkIn:k?k.date.toISOString().split("T")[0]:"",checkOut:v?v.date.toISOString().split("T")[0]:"",onClose:()=>E(!1),onSubmit:je,initialGuestName:W,initialPersonCount:V?parseInt(V):0,onRefresh:t,selectedzimmerId:_||void 0}),M&&(0,p.jsx)(G,{isVisible:N,booking:M,onClose:()=>{A(!1),R(null)},onUpdate:ke,onDelete:Ce,onRefresh:t})]})}const le=h.default.create({container:{flex:1,backgroundColor:"#fff",paddingTop:40},controlsContainer:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",height:40,paddingHorizontal:16,backgroundColor:"#f5f5f5"},monthYearText:{fontSize:16,fontWeight:"bold"},monthButtonsContainer:{flexDirection:"row",justifyContent:"space-around",marginVertical:8,paddingHorizontal:16,backgroundColor:"#eee"},monthButton:{paddingVertical:6,paddingHorizontal:10,borderRadius:4,backgroundColor:"#ddd"},monthButtonText:{fontSize:12,fontWeight:"500"},tableContainer:{flex:1,position:"relative"},fixedColumn:{width:80,position:"absolute",left:0,top:0,bottom:0,zIndex:1},horizontalScroll:{flex:1,marginLeft:80},headerRow:{flexDirection:"row",borderBottomWidth:1,borderColor:"#ccc"},headerCell:{backgroundColor:"#eee",borderRightWidth:1,borderBottomWidth:1,borderColor:"#ccc",justifyContent:"center",alignItems:"center",height:35},headerSmallText:{fontSize:10,color:"#555"},headerDayNumber:{fontSize:16,fontWeight:"bold",color:"#333"},headerCellText:{fontSize:12,fontWeight:"bold"},leftHeaderCell:{borderBottomWidth:1,borderColor:"#ccc"},todayHeader:{backgroundColor:"#b3e6ff"},weekendHeader:{backgroundColor:"#cccccc"},zimmerRow:{flexDirection:"row"},zimmerCell:{backgroundColor:"#fafafa",borderBottomWidth:1,borderColor:"#ccc",justifyContent:"center",alignItems:"center",height:35,width:80},zimmerText:{fontSize:12,fontWeight:"bold"},dayCell:{borderRightWidth:1,borderBottomWidth:1,borderColor:"#ccc",justifyContent:"center",alignItems:"center"},selectedDayCell:{backgroundColor:"#d0f0ff"},dayCellText:{fontSize:10,color:"#333"},overlayContainer:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"box-none"},bookingBlock:{position:"absolute",top:0,height:35,borderWidth:1,borderColor:"#99cc99",justifyContent:"center",alignItems:"center",paddingHorizontal:2},bookingBlockText:{fontSize:9,fontWeight:"600",color:"#333",textAlign:"center",flexWrap:"wrap"},bookingButton:{backgroundColor:"#007AFF",padding:12,margin:16,borderRadius:6,alignItems:"center"},bookingButtonText:{color:"#fff",fontSize:16},searchContainer:{flexDirection:"row",alignItems:"center",padding:8},searchInput:{flex:1,borderWidth:1,borderColor:"#ccc",padding:8,borderRadius:4,marginRight:8}}),ie=h.default.create({container:{flex:1,padding:16,backgroundColor:"#fff"},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:16},searchInput:{borderWidth:1,borderColor:"#ccc",padding:8,marginBottom:16,borderRadius:4},sectionTitle:{fontSize:20,fontWeight:"bold",marginTop:16,marginBottom:8},card:{backgroundColor:"#f9f9f9",padding:12,borderRadius:6,marginBottom:12},boldText:{fontWeight:"bold"},radioGroup:{flexDirection:"row",marginTop:8},radioButton:{padding:8,borderWidth:1,borderColor:"#ccc",backgroundColor:"#f0f0f0",borderRadius:4,marginRight:8},radioButtonRed:{backgroundColor:"#FF5733",borderColor:"#FF5733"},radioButtonGreen:{backgroundColor:"#4CAF50",borderColor:"#4CAF50"},radioText:{fontSize:16,color:"#000"}}),oe=({onRefresh:e})=>{const[t,n]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[i,o]=(0,r.useState)(""),c=async()=>{try{const e=(new Date).toISOString().split("T")[0],{data:t,error:a}=await b.from("buchungen").select("*").or("status.eq.anzahlung,status.eq.anzahlung_bezahlt").gte("check_in",e).order("check_in",{ascending:!0});if(a)throw a;t&&n(t);const{data:r,error:i}=await b.from("gaeste").select("*");if(i)throw i;r&&l(r)}catch(e){console.error("Fehler beim Laden der Daten:",e),F.default.alert("Fehler","Daten konnten nicht geladen werden.")}};(0,r.useEffect)((()=>{c();const e=setInterval(c,12e4);return()=>clearInterval(e)}),[]),(0,r.useEffect)((()=>{e&&e()}),[e]);const h=async(e,t)=>{try{const{error:n}=await b.from("buchungen").update({status:t}).eq("id",e);if(n)throw n;F.default.alert("Erfolg","Status erfolgreich ge\xe4ndert."),c()}catch(n){console.error("Fehler beim Aktualisieren des Status:",n),F.default.alert("Fehler","Status konnte nicht ge\xe4ndert werden.")}},f=i?t.filter((e=>{const t=a.find((t=>t.id===e.gast_id));if(!t)return!1;return`${t.vorname} ${t.nachname}`.toLowerCase().includes(i.toLowerCase())})):t,g=f.filter((e=>"anzahlung"===e.status&&new Date(e.check_in)>new Date)).reduce(((e,t)=>e+t.anzahlung),0),m=f.filter((e=>"anzahlung_bezahlt"===e.status&&new Date(e.check_out)>new Date)).reduce(((e,t)=>e+t.anzahlung),0);return(0,p.jsxs)(S.default,{style:ie.container,children:[(0,p.jsx)(j,{}),(0,p.jsx)(d.default,{style:ie.title,children:"Anzahlungen"}),(0,p.jsx)(u.default,{style:ie.searchInput,placeholder:"G\xe4ste suchen...",value:i,onChangeText:o}),(0,p.jsxs)(d.default,{style:ie.sectionTitle,children:["Offene Anzahlungen (",g," \u20ac)"]}),f.filter((e=>"anzahlung"===e.status)).map((e=>{const t=a.find((t=>t.id===e.gast_id));return(0,p.jsxs)(s.default,{style:ie.card,children:[(0,p.jsxs)(d.default,{children:[(0,p.jsx)(d.default,{style:ie.boldText,children:t?`${t.vorname} ${t.nachname}`:"Unbekannter Gast"})," - ",e.check_in," bis ",e.check_out]}),(0,p.jsxs)(d.default,{children:["Anzahlung: ",e.anzahlung," \u20ac"]}),(0,p.jsxs)(s.default,{style:ie.radioGroup,children:[(0,p.jsx)(z.default,{style:[ie.radioButton,"anzahlung"===e.status&&ie.radioButtonRed],onPress:()=>h(e.id,"anzahlung"),children:(0,p.jsx)(d.default,{style:ie.radioText,children:"Nicht bezahlt"})}),(0,p.jsx)(z.default,{style:[ie.radioButton,"anzahlung_bezahlt"===e.status&&ie.radioButtonGreen],onPress:()=>h(e.id,"anzahlung_bezahlt"),children:(0,p.jsx)(d.default,{style:ie.radioText,children:"Bezahlt"})})]})]},e.id)})),(0,p.jsxs)(d.default,{style:ie.sectionTitle,children:["Bezahlte Anzahlungen (",m," \u20ac)"]}),f.filter((e=>"anzahlung_bezahlt"===e.status)).map((e=>{const t=a.find((t=>t.id===e.gast_id));return(0,p.jsxs)(s.default,{style:ie.card,children:[(0,p.jsxs)(d.default,{children:[(0,p.jsx)(d.default,{style:ie.boldText,children:t?`${t.vorname} ${t.nachname}`:"Unbekannter Gast"})," - ",e.check_in," bis ",e.check_out]}),(0,p.jsxs)(d.default,{children:["Anzahlung: ",e.anzahlung," \u20ac"]}),(0,p.jsxs)(s.default,{style:ie.radioGroup,children:[(0,p.jsx)(z.default,{style:[ie.radioButton,"anzahlung"===e.status&&ie.radioButtonRed],onPress:()=>h(e.id,"anzahlung"),children:(0,p.jsx)(d.default,{style:ie.radioText,children:"Nicht bezahlt"})}),(0,p.jsx)(z.default,{style:[ie.radioButton,"anzahlung_bezahlt"===e.status&&ie.radioButtonGreen],onPress:()=>h(e.id,"anzahlung_bezahlt"),children:(0,p.jsx)(d.default,{style:ie.radioText,children:"Bezahlt"})})]})]},e.id)}))]})};var se=n(932),de=n(8264);const ue=h.default.create({container:{flex:1,padding:20,justifyContent:"center"},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:24},section:{marginBottom:40},sectionTitle:{fontSize:18,fontWeight:"bold",marginBottom:12},input:{height:40,borderColor:"#ccc",borderWidth:1,borderRadius:4,paddingHorizontal:10,marginBottom:12},ferienItem:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:8},ferienButtons:{flexDirection:"row"},modalContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0,0,0,0.5)"},modalContent:{backgroundColor:"white",padding:20,borderRadius:10,width:"80%"}}),ce=()=>{const[e,t]=(0,r.useState)(""),[n,a]=(0,r.useState)(""),[l,i]=(0,r.useState)([]),[o,h]=(0,r.useState)(!1),[f,x]=(0,r.useState)(null),[y,j]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),S=(0,m.useNavigation)(),z=async()=>{try{const e=(new Date).toISOString().split("T")[0],{data:t,error:n}=await b.from("buchungen").select("check_in, check_out").eq("status","Ferien").gt("check_out",e);if(n)throw n;if(t){const e={};t.forEach((t=>{const n=`${t.check_in}_${t.check_out}`;e[n]={check_in:t.check_in,check_out:t.check_out}})),i(Object.values(e))}}catch(e){F.default.alert("Fehler",e.message)}};(0,r.useEffect)((()=>{z()}),[]);return(0,p.jsxs)(s.default,{style:ue.container,children:[(0,p.jsx)(d.default,{style:ue.title,children:"Einstellungen"}),(0,p.jsxs)(s.default,{style:ue.section,children:[(0,p.jsx)(d.default,{style:ue.sectionTitle,children:"Ferien eintragen"}),(0,p.jsx)(u.default,{style:ue.input,placeholder:"Startdatum (YYYY-MM-DD)",value:e,onChangeText:t}),(0,p.jsx)(u.default,{style:ue.input,placeholder:"Enddatum (YYYY-MM-DD)",value:n,onChangeText:a}),(0,p.jsx)(c.default,{title:"Ferien eintragen",onPress:async()=>{if(e&&n)try{const{data:r,error:l}=await b.from("buchungen").select("zimmer_id").filter("check_in","lt",n).filter("check_out","gt",e);if(l)throw l;if(r&&r.length>0)return void F.default.alert("Nicht m\xf6glich","In mindestens einem Zimmer existiert bereits eine Buchung in diesem Zeitraum.");const{data:i,error:o}=await b.from("zimmer").select("id");if(o)throw o;if(!i||0===i.length)return void F.default.alert("Fehler","Keine Zimmer gefunden.");const{data:s}=await b.from("gaeste").select("id").eq("vorname","Ferien").eq("nachname","Ferien");let d;if(s&&s.length>0)d=s[0].id;else{const{data:e,error:t}=await b.from("gaeste").insert([{vorname:"Ferien",nachname:"Ferien"}]).select("*").single();if(t)throw t;d=e.id}const u=i.map((t=>({zimmer_id:t.id,gast_id:d,check_in:e,check_out:n,anzahl_personen:0,preis_pro_person:0,anzahlung:0,status:"Ferien",verpflegung:"",hund:!1,zusatz_preis:"",tel_email:"",notiz:"Ferienbuchung"}))),{error:c}=await b.from("buchungen").insert(u);if(c)throw c;F.default.alert("Erfolg","Ferien erstellt."),t(""),a(""),z()}catch(r){console.error(r),F.default.alert("Fehler",r.message)}else F.default.alert("Fehler","Bitte Start- und Enddatum angeben.")}})]}),(0,p.jsxs)(s.default,{style:ue.section,children:[(0,p.jsx)(d.default,{style:ue.sectionTitle,children:"Bevorstehende Ferien"}),(0,p.jsx)(se.default,{data:l,keyExtractor:e=>e.check_in+"_"+e.check_out,renderItem:({item:e})=>(0,p.jsxs)(s.default,{style:ue.ferienItem,children:[(0,p.jsxs)(d.default,{children:[e.check_in," bis ",e.check_out]}),(0,p.jsxs)(s.default,{style:ue.ferienButtons,children:[(0,p.jsx)(c.default,{title:"Bearbeiten",onPress:()=>{x(e),j(e.check_in),C(e.check_out),h(!0)}}),(0,p.jsx)(c.default,{title:"L\xf6schen",onPress:()=>(async(e,t)=>{try{const{error:n}=await b.from("buchungen").delete().eq("status","Ferien").eq("check_in",e).eq("check_out",t);if(n)throw n;F.default.alert("Erfolg","Ferien gel\xf6scht."),z()}catch(n){F.default.alert("Fehler",n.message)}})(e.check_in,e.check_out),color:"red"})]})]}),ListEmptyComponent:(0,p.jsx)(d.default,{children:"Keine Ferien eingetragen."})})]}),(0,p.jsxs)(s.default,{style:ue.section,children:[(0,p.jsx)(d.default,{style:ue.sectionTitle,children:"Logout"}),(0,p.jsx)(c.default,{title:"Logout",onPress:async()=>{try{await b.auth.signOut(),await g.default.clear(),S.reset({index:0,routes:[{name:"Login"}]})}catch(e){F.default.alert("Fehler",e.message||"Logout fehlgeschlagen.")}},color:"red"})]}),(0,p.jsx)(de.default,{visible:o,animationType:"slide",transparent:!0,onRequestClose:()=>h(!1),children:(0,p.jsx)(s.default,{style:ue.modalContainer,children:(0,p.jsxs)(s.default,{style:ue.modalContent,children:[(0,p.jsx)(d.default,{children:"Ferien bearbeiten"}),(0,p.jsx)(u.default,{style:ue.input,placeholder:"Neues Startdatum (YYYY-MM-DD)",value:y,onChangeText:j}),(0,p.jsx)(u.default,{style:ue.input,placeholder:"Neues Enddatum (YYYY-MM-DD)",value:k,onChangeText:C}),(0,p.jsx)(c.default,{title:"Speichern",onPress:async()=>{if(y&&k&&f)try{const{error:e}=await b.from("buchungen").update({check_in:y,check_out:k}).eq("status","Ferien").eq("check_in",f.check_in).eq("check_out",f.check_out);if(e)throw e;F.default.alert("Erfolg","Ferien aktualisiert."),h(!1),x(null),z()}catch(e){F.default.alert("Fehler",e.message)}else F.default.alert("Fehler","Bitte neue Start- und Enddaten angeben.")}}),(0,p.jsx)(c.default,{title:"Abbrechen",onPress:()=>h(!1),color:"red"})]})})})]})},he=(0,i.createNativeStackNavigator)();(0,a.default)((function(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),i=(0,r.useCallback)((async()=>{if(n)try{console.log("\ud83d\udd04 Vollst\xe4ndiges Laden der Buchungen...");const{data:e,error:n}=await b.from("buchungen").select("*").is("deleted_at",null);if(n)return void console.error("\u274c Fehler beim Voll-Laden der Buchungen:",n);console.log("\ud83d\udce5 Vollst\xe4ndig geladene Buchungen:",e),e&&t(e)}catch(e){console.error("\u26a0\ufe0f Fehler in syncFullBuchungen:",e)}}),[n]);return(0,r.useEffect)((()=>{const e=o.default.addEventListener((e=>{a(e.isConnected)}));i();const t=setInterval(i,12e4);return()=>{clearInterval(t),e()}}),[i]),console.log("\ud83d\udcca Buchungen in App.tsx:",e),(0,p.jsx)(l.NavigationContainer,{children:(0,p.jsxs)(he.Navigator,{initialRouteName:"Login",children:[(0,p.jsx)(he.Screen,{name:"Login",component:k}),(0,p.jsx)(he.Screen,{name:"Home",component:D}),(0,p.jsx)(he.Screen,{name:"Calendarscreen",children:()=>(0,p.jsx)(re,{buchungen:e,onRefresh:i})}),(0,p.jsx)(he.Screen,{name:"AnzahlungenScreen",children:()=>(0,p.jsx)(oe,{onRefresh:i})}),(0,p.jsx)(he.Screen,{name:"EinstellungenScreen",component:ce})]})})}))},4082:(e,t,n)=>{e.exports=n.p+"static/media/logo.dd0213c004f3f047ac5b.png"},7635:(e,t,n)=>{e.exports=n.p+"static/media/LogoBetrieb.c5ef20b02b90bcffbb09.png"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.m=e,(()=>{var e=[];n.O=(t,a,r,l)=>{if(!a){var i=1/0;for(u=0;u<e.length;u++){for(var[a,r,l]=e[u],o=!0,s=0;s<a.length;s++)(!1&l||i>=l)&&Object.keys(n.O).every((e=>n.O[e](a[s])))?a.splice(s--,1):(o=!1,l<i&&(i=l));if(o){e.splice(u--,1);var d=r();void 0!==d&&(t=d)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,r,l]}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(a,r){if(1&r&&(a=this(a)),8&r)return a;if("object"===typeof a&&a){if(4&r&&a.__esModule)return a;if(16&r&&"function"===typeof a.then)return a}var l=Object.create(null);n.r(l);var i={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&a;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>i[e]=()=>a[e]));return i.default=()=>a,n.d(l,i),l}})(),n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,a)=>(n.f[a](e,t),t)),[])),n.u=e=>"static/js/"+e+".783bc47a.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="web:";n.l=(a,r,l,i)=>{if(e[a])e[a].push(r);else{var o,s;if(void 0!==l)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==a||c.getAttribute("data-webpack")==t+l){o=c;break}}o||(s=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+l),o.src=a),e[a]=[r];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(f);var r=e[a];if(delete e[a],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(n))),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),s&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/Oberraut/",(()=>{var e={792:0};n.f.j=(t,a)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)a.push(r[2]);else{var l=new Promise(((n,a)=>r=e[t]=[n,a]));a.push(r[2]=l);var i=n.p+n.u(t),o=new Error;n.l(i,(a=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var l=a&&("load"===a.type?"missing":a.type),i=a&&a.target&&a.target.src;o.message="Loading chunk "+t+" failed.\n("+l+": "+i+")",o.name="ChunkLoadError",o.type=l,o.request=i,r[1](o)}}),"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,a)=>{var r,l,[i,o,s]=a,d=0;if(i.some((t=>0!==e[t]))){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(s)var u=s(n)}for(t&&t(a);d<i.length;d++)l=i[d],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(u)},a=self.webpackChunkweb=self.webpackChunkweb||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=n.O(void 0,[624],(()=>n(211)));a=n.O(a)})();
//# sourceMappingURL=main.b6d6ae98.js.map
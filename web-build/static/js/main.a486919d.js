(()=>{"use strict";var e={211:(e,t,n)=>{var a=n(2299),r=n(6665),l=n(5479),o=n(7114),i=n(5086),s=n(3929),d=n(6283),u=n(6773),c=n(8180),h=n(3668),f=n(530),g=n(1087),m=n(3947);const b=(0,n(8336).createClient)("https://elywhketsxozigeycjkj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVseXdoa2V0c3hvemlnZXljamtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0OTU5MjEsImV4cCI6MjA1NjA3MTkyMX0.oIfd4wPU2UocrmRXIWeCHsofz2rFekWTD5ISMiRAQ70");var x=n(484),p=n(397);const y=h.default.create({header:{height:50,flexDirection:"row",alignItems:"center",backgroundColor:"#fff",borderBottomWidth:1,borderBottomColor:"#ccc",paddingHorizontal:10},sideContainer:{flex:1,alignItems:"center"},logo:{width:80,height:80,resizeMode:"contain"},logoBetrieb:{width:100,height:100,resizeMode:"contain"}}),j=()=>(0,p.jsxs)(s.default,{style:y.header,children:[(0,p.jsx)(s.default,{style:y.sideContainer}),(0,p.jsx)(x.default,{source:n(4082),style:y.logo}),(0,p.jsx)(s.default,{style:y.sideContainer,children:(0,p.jsx)(x.default,{source:n(7635),style:y.logoBetrieb})})]});function k(){const e=(0,m.useNavigation)(),[t,n]=(0,r.useState)(""),[a,l]=(0,r.useState)(""),[o,i]=(0,r.useState)(""),[h,x]=(0,r.useState)(!0);(0,r.useEffect)((()=>{(async()=>{try{const t=await g.default.getItem("lastLogin"),{data:{session:n}}=await b.auth.getSession();if(t&&n){const n=new Date(parseInt(t)),a=new Date;if((a.getTime()-n.getTime())/36e5<24)return void e.replace("Home")}}catch(t){console.error("Fehler beim Pr\xfcfen der gespeicherten Anmeldung:",t)}x(!1)})()}),[]);return h?(0,p.jsxs)(s.default,{style:C.loadingContainer,children:[(0,p.jsx)(f.default,{size:"large",color:"#007AFF"}),(0,p.jsx)(d.default,{children:"Pr\xfcfe Login..."})]}):(0,p.jsxs)(s.default,{style:C.container,children:[(0,p.jsx)(j,{}),(0,p.jsx)(d.default,{style:C.title,children:"Login"}),o?(0,p.jsx)(d.default,{style:C.error,children:o}):null,(0,p.jsx)(u.default,{style:C.input,placeholder:"E-Mail",autoCapitalize:"none",keyboardType:"email-address",value:t,onChangeText:n}),(0,p.jsx)(u.default,{style:C.input,placeholder:"Passwort",secureTextEntry:!0,value:a,onChangeText:l}),(0,p.jsx)(c.default,{title:"Einloggen",onPress:async()=>{i(""),x(!0);try{const{data:n,error:r}=await b.auth.signInWithPassword({email:t,password:a});r||!n.user?(i(r?r.message:"Login fehlgeschlagen"),x(!1)):(await g.default.setItem("lastLogin",Date.now().toString()),e.replace("Home"))}catch(n){i(n.message),x(!1)}},disabled:h})]})}const C=h.default.create({container:{flex:1,padding:20,justifyContent:"center"},title:{fontSize:26,marginBottom:20,textAlign:"center"},error:{color:"red",marginBottom:10,textAlign:"center"},input:{borderWidth:1,borderColor:"#ccc",marginBottom:12,paddingVertical:8,paddingHorizontal:10,borderRadius:6},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center"}});var S=n(2772),v=n(5648),z=n(4754);function w(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function _(e,t){return t.findIndex((t=>w(t.date,e)))}function B(e,t,n,a){const r=n.filter((t=>t.zimmer_id===e.id)).filter((e=>{const n=new Date(e.check_in),a=new Date(e.check_out);return w(t,n)||w(t,a)||t>n&&t<a}));return 0===r.length?(0,p.jsx)(s.default,{style:[T.statusBar,{backgroundColor:"#d3d3d3"}],children:(0,p.jsx)(d.default,{style:T.statusBarText,children:"Frei"})}):(0,p.jsx)(s.default,{style:T.statusBarsContainer,children:r.map((e=>{const n=new Date(e.check_in),r=new Date(e.check_out),l=a.find((t=>t.id===e.gast_id)),o=l?l.nachname:"Unbekannt";let i="";e.verpflegung&&(i="Fr\xfchst\xfcck"===e.verpflegung?"B&B":"Halbpension"===e.verpflegung?"HP":e.verpflegung);let u="",c="";return w(n,r)?(u=`Check-in/Check-out: ${o} (${e.anzahl_personen} P.) [${i}]`,c="#ADD8E6"):w(t,n)?(u=`Check-in: ${o} (${e.anzahl_personen} P.) [${i}]`,c="#ADD8E6"):w(t,r)?(u=`Check-out: ${o} (${e.anzahl_personen} P.) [${i}]`,c="#FFDAB9"):(u=`belegt: ${o} (${e.anzahl_personen} P.) [${i}]`,c="#90EE90"),(0,p.jsx)(s.default,{style:[T.statusBar,{backgroundColor:c}],children:(0,p.jsx)(d.default,{style:T.statusBarText,children:u})},e.id)}))})}const T=h.default.create({container:{flex:1,padding:16,backgroundColor:"#fff"},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:16},dateSelector:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:16},dateText:{fontSize:18,fontWeight:"bold"},navigationButtons:{flexDirection:"row",justifyContent:"space-around",marginBottom:16},roomList:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},roomCard:{width:"48%",backgroundColor:"#f9f9f9",padding:8,marginBottom:16,borderRadius:4,borderWidth:1,borderColor:"#ddd"},roomTitle:{fontSize:16,fontWeight:"bold",marginBottom:4},statusText:{fontSize:14},statusBar:{padding:4,borderRadius:4,marginVertical:2},statusBarText:{fontSize:14,color:"#000"},statusBarsContainer:{flexDirection:"column"},guestName:{color:"blue",textDecorationLine:"underline",marginVertical:2},summary:{marginVertical:16},summaryBorder:{borderTopWidth:1,borderColor:"#ccc",paddingVertical:8},summaryText:{fontSize:16},customModalContainer:{margin:0,justifyContent:"center"},customModalOverlay:{flex:1,backgroundColor:"rgba(0,0,0,0.5)",justifyContent:"center",alignItems:"center",padding:16},customModalContent:{backgroundColor:"#fff",padding:16,borderRadius:8,width:"85%"},modalTitle:{fontSize:18,fontWeight:"bold",marginBottom:12,textAlign:"center"},navFooter:{flexDirection:"row",justifyContent:"space-around",marginTop:16}}),D=()=>{const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)([]),[l,o]=(0,r.useState)([]),[i,u]=(0,r.useState)([]),[h,f]=(0,r.useState)(new Date),[g,x]=(0,r.useState)(""),[y,k]=(0,r.useState)(!1),[C,D]=(0,r.useState)(null),F=(0,r.useRef)(null),P=(0,m.useNavigation)(),I=async()=>{try{const{data:e}=await b.from("zimmer").select("*");e&&a(e);const{data:t}=await b.from("buchungen").select("*");t&&o(t);const{data:n}=await b.from("gaeste").select("*");n&&u(n)}catch(e){console.error("Fehler beim Laden der Daten:",e)}};(0,r.useEffect)((()=>{t(function(){const e=[],t=new Date;t.setDate(t.getDate()-60);const n=new Date;n.setMonth(n.getMonth()+18);let a=new Date(t);for(;a<=n;){const t=a.getDate().toString().padStart(2,"0"),n=a.toLocaleDateString("de-DE",{month:"2-digit",year:"numeric"}).replace(".","/");e.push({date:new Date(a),dayNumber:t,monthYear:n}),a.setDate(a.getDate()+1)}return e}()),I();const e=setInterval(I,12e4);return()=>clearInterval(e)}),[]),(0,r.useEffect)((()=>{if(e.length>0&&F.current){const t=_(new Date,e);if(-1!==t){const e=80+60*t;F.current?.scrollTo({x:e,animated:!1})}}}),[e]);const O=e=>{const t=new Date(h);t.setDate(t.getDate()+e),f(t)},E=e=>{D(e),k(!0)},N=()=>{P.navigate("Calendarscreen")},A=()=>{P.navigate("AnzahlungenScreen")},M=()=>{P.navigate("EinstellungenScreen")};return(0,p.jsxs)(S.default,{style:T.container,children:[(0,p.jsx)(j,{}),(0,p.jsx)(d.default,{style:T.title,children:"Tages\xfcbersicht"}),(0,p.jsxs)(s.default,{style:T.dateSelector,children:[(0,p.jsx)(c.default,{title:"\u2039",onPress:()=>O(-1)}),(0,p.jsx)(d.default,{style:T.dateText,children:(R=h,`${R.getDate().toString().padStart(2,"0")}.${(R.getMonth()+1).toString().padStart(2,"0")}.${R.getFullYear()}`)}),(0,p.jsx)(c.default,{title:"\u203a",onPress:()=>O(1)})]}),(0,p.jsxs)(s.default,{style:T.navigationButtons,children:[(0,p.jsx)(c.default,{title:"Zum Kalender",onPress:N}),(0,p.jsx)(c.default,{title:"Anzahlungen",onPress:A}),(0,p.jsx)(c.default,{title:"Einstellungen",onPress:M})]}),(0,p.jsx)(s.default,{style:T.roomList,children:n.map((e=>(0,p.jsxs)(s.default,{style:T.roomCard,children:[(0,p.jsxs)(d.default,{style:T.roomTitle,children:["Zimmer ",e.nummer]}),B(e,h,l,i)]},e.id)))}),(0,p.jsxs)(s.default,{style:T.summary,children:[(0,p.jsx)(s.default,{style:T.summaryBorder,children:(0,p.jsxs)(d.default,{style:T.summaryText,children:["Fr\xfchst\xfcck (B&B):"," ",l.filter((e=>("Fr\xfchst\xfcck"===e.verpflegung||"Halbpension"===e.verpflegung)&&new Date(e.check_in)<=h&&new Date(e.check_out)>=h)).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]})}),(0,p.jsx)(s.default,{style:T.summaryBorder,children:(0,p.jsxs)(d.default,{style:T.summaryText,children:["Halbpension (HP):"," ",l.filter((e=>"Halbpension"===e.verpflegung&&new Date(e.check_in)<=h&&new Date(e.check_out)>=h)).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]})}),(0,p.jsxs)(s.default,{style:T.summaryBorder,children:[(0,p.jsxs)(d.default,{style:T.summaryText,children:["Check-Ins:"," ",l.filter((e=>w(new Date(e.check_in),h))).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]}),l.filter((e=>w(new Date(e.check_in),h))).map(((e,t)=>{const a=i.find((t=>t.id===e.gast_id)),r=n.find((t=>t.id===e.zimmer_id))?.nummer||"";return(0,p.jsx)(v.default,{onPress:()=>E(e),children:(0,p.jsxs)(d.default,{style:T.guestName,children:["Zimmer ",r," - ",a?`${a.vorname} ${a.nachname}`:"Unbekannt"]})},`in-${t}`)}))]}),(0,p.jsxs)(s.default,{style:T.summaryBorder,children:[(0,p.jsxs)(d.default,{style:T.summaryText,children:["Check-Outs:"," ",l.filter((e=>w(new Date(e.check_out),h))).reduce(((e,t)=>e+t.anzahl_personen),0)," ","P."]}),l.filter((e=>w(new Date(e.check_out),h))).map(((e,t)=>{const a=i.find((t=>t.id===e.gast_id)),r=n.find((t=>t.id===e.zimmer_id))?.nummer||"";return(0,p.jsx)(v.default,{onPress:()=>E(e),children:(0,p.jsxs)(d.default,{style:T.guestName,children:["Zimmer ",r," - ",a?`${a.vorname} ${a.nachname}`:"Unbekannt"]})},`out-${t}`)}))]}),(0,p.jsxs)(s.default,{style:T.summaryBorder,children:[(0,p.jsx)(d.default,{style:T.summaryText,children:"Anwesende G\xe4ste:"}),l.filter((e=>h>new Date(e.check_in)&&h<new Date(e.check_out))).map(((e,t)=>{const a=i.find((t=>t.id===e.gast_id)),r=n.find((t=>t.id===e.zimmer_id))?.nummer||"";return(0,p.jsx)(v.default,{onPress:()=>E(e),children:(0,p.jsxs)(d.default,{style:T.guestName,children:["Zimmer ",r," - ",a?`${a.vorname} ${a.nachname}`:"Unbekannt"]})},`active-${t}`)}))]})]}),C&&(0,p.jsx)(z.default,{isVisible:y,onBackdropPress:()=>k(!1),useNativeDriver:!1,style:T.customModalContainer,children:(0,p.jsx)(s.default,{style:T.customModalOverlay,children:(0,p.jsxs)(s.default,{style:T.customModalContent,children:[(0,p.jsx)(d.default,{style:T.modalTitle,children:"Buchungsdetails"}),(0,p.jsxs)(d.default,{children:["Zimmer:"," ",n.find((e=>e.id===C.zimmer_id))?.nummer]}),(0,p.jsxs)(d.default,{children:["Check-In: ",C.check_in]}),(0,p.jsxs)(d.default,{children:["Check-Out: ",C.check_out]}),(0,p.jsxs)(d.default,{children:["Gast:"," ",(()=>{const e=i.find((e=>e.id===C.gast_id));return e?`${e.vorname} ${e.nachname}`:"Unbekannt"})()]}),(0,p.jsxs)(d.default,{children:["Personen: ",C.anzahl_personen]}),(0,p.jsxs)(d.default,{children:["Status: ",C.status]}),(0,p.jsxs)(d.default,{children:["Verpflegung: ",C.verpflegung||"-"]}),(0,p.jsxs)(d.default,{children:["Anzahlung: ",C.anzahlung]}),(0,p.jsxs)(d.default,{children:["Preis pro Person: ",C.preis_pro_person]}),(0,p.jsxs)(d.default,{children:["Zusatz Preis: ",C.zusatz_preis]}),(0,p.jsxs)(d.default,{children:["Tel.: / email: ",C.tel_email]}),(0,p.jsxs)(d.default,{children:["Notiz: ",C.notiz||"-"]}),(0,p.jsx)(c.default,{title:"Schlie\xdfen",onPress:()=>k(!1)})]})})}),(0,p.jsxs)(s.default,{style:T.navFooter,children:[(0,p.jsx)(c.default,{title:"Zum Kalender",onPress:N}),(0,p.jsx)(c.default,{title:"Anzahlungen",onPress:A}),(0,p.jsx)(c.default,{title:"Einstellungen",onPress:M})]})]});var R};var F=n(1690),P=n(2365),I=n(1950);function O(e,t){window.alert(`${e}: ${t}`)}const E=(0,r.memo)((({options:e,selectedValue:t,onChange:n})=>(0,p.jsx)(s.default,{style:R.radioGroup,children:e.map((e=>{const a=e.value===t;return(0,p.jsx)(I.default,{onPress:()=>n(e.value),children:(0,p.jsx)(s.default,{style:[R.radioOption,a&&R.radioOptionSelected],children:(0,p.jsx)(d.default,{style:[R.radioLabel,a&&R.radioLabelSelected],children:e.label})})},e.value)}))}))),N=[{label:"Belegt",value:"belegt"},{label:"Anzahlung",value:"anzahlung"},{label:"Anz. bez",value:"anzahlung_bezahlt"}],A=[{label:"Fr\xfchst\xfcck",value:"Fr\xfchst\xfcck"},{label:"Halbpension",value:"Halbpension"}],M=[{label:"Nein",value:"nein"},{label:"Ja",value:"ja"}],R=h.default.create({modalContainer:{margin:0,justifyContent:"flex-end"},scrollContainer:{flexGrow:1,justifyContent:"center"},modalOverlay:{flexGrow:1,backgroundColor:"rgba(0,0,0,0.5)",padding:16,justifyContent:"center"},modalContent:{backgroundColor:"#fff",borderRadius:8,padding:16,width:"85%",alignSelf:"center"},modalTitle:{fontSize:18,fontWeight:"bold",marginBottom:12,textAlign:"center"},label:{marginTop:8,fontWeight:"600",marginBottom:4,fontSize:16},input:{height:40,fontSize:16,paddingVertical:8,paddingHorizontal:10,borderWidth:1,borderColor:"#ccc",borderRadius:4,color:"black",marginBottom:12},radioGroup:{flexDirection:"row",marginBottom:12},radioOption:{paddingVertical:4,paddingHorizontal:8,borderWidth:1,borderColor:"#ccc",borderRadius:4,marginRight:8},radioOptionSelected:{backgroundColor:"#007AFF",borderColor:"#007AFF"},radioLabel:{fontSize:16,color:"black"},radioLabelSelected:{color:"#fff"},buttonRow:{flexDirection:"row",justifyContent:"space-around",marginTop:12}}),$=(0,r.memo)((({isVisible:e,checkIn:t,checkOut:n,onClose:a,onSubmit:l,onRefresh:o,initialGuestName:i="",initialPersonCount:h=0,selectedRoomId:f})=>{const[g,m]=(0,r.useState)(i),[x,y]=(0,r.useState)(h.toString()),[j,k]=(0,r.useState)("belegt"),[C,v]=(0,r.useState)("0"),[w,_]=(0,r.useState)("Fr\xfchst\xfcck"),[B,T]=(0,r.useState)(""),[D,F]=(0,r.useState)("nein"),[I,$]=(0,r.useState)(""),[L,W]=(0,r.useState)(""),[Y,V]=(0,r.useState)(""),[H,Z]=(0,r.useState)(!1);(0,r.useEffect)((()=>{e&&(m(i),y(h.toString()),k("belegt"),v("0"),_("Fr\xfchst\xfcck"),T(""),F("nein"),$(""),W(""),V(""),Z(!1))}),[e,i,h]),(0,r.useEffect)((()=>{""!==C.trim()&&"0"!==C&&k("anzahlung")}),[C]);const G=g.trim().split(" ").length>=2&&!isNaN(parseInt(x))&&parseInt(x)>0,q=(0,r.useCallback)((async(e,t,n)=>{const{data:a,error:r}=await b.from("buchungen").select("id").eq("zimmer_id",e).is("deleted_at",null).filter("check_in","lt",n).filter("check_out","gt",t);return r?(O("Fehler","Fehler bei der Verf\xfcgbarkeitspr\xfcfung."),!1):a&&0===a.length}),[]),U=(0,r.useCallback)((async()=>{if(H)return;if(!f)return void O("Fehler","Kein Zimmer ausgew\xe4hlt.");const e=parseInt(x);if(isNaN(e)||e<=0)O("Fehler","Bitte eine g\xfcltige Anzahl an Personen eingeben.");else{Z(!0);try{const r=parseFloat(C),l=""===B.trim()?null:parseFloat(B),i=I.trim();console.log("Submitting booking with data:",{guestName:g,personCount:e,status:j,anzahlung:isNaN(r)?0:r,verpflegung:w,preisProPerson:l,hund:"ja"===D,zusatzPreis:i,notiz:Y,tel_email:L});const s=g.trim().split(" ");if(s.length<2)return O("Fehler","Bitte Vor- und Nachname eingeben."),void Z(!1);let d=null;const{data:u,error:c}=await b.from("gaeste").select("id").eq("vorname",s[0]).eq("nachname",s[1]);if(c&&console.log("Fehler bei der Gast-Suche",c),u&&u.length>0)d=u[0].id;else{const{data:e}=await b.from("gaeste").insert([{vorname:s[0],nachname:s[1]}]).select("*").single();if(!e)return O("Fehler","Gast konnte nicht erstellt werden."),void Z(!1);d=e.id}if(!await q(f,t,n))return O("Fehler","Das Zimmer ist im angegebenen Zeitraum bereits vergeben."),void Z(!1);const{error:h}=await b.from("buchungen").insert([{zimmer_id:f,gast_id:d,check_in:t,check_out:n,anzahl_personen:e,preis_pro_person:l??0,anzahlung:isNaN(r)?0:r,status:j,verpflegung:w,hund:"ja"===D,zusatz_preis:i,tel_email:L,notiz:Y}]);h?O("Fehler",h.message):(O("Erfolg","Buchung erstellt!"),a(),o&&await o())}catch(r){console.error("Fehler beim Erstellen der Buchung:",r),O("Fehler",r.message||"Unbekannter Fehler beim Erstellen der Buchung.")}Z(!1)}}),[H,x,C,B,I,g,j,w,D,L,Y,t,n,f,a,o,q]),K=(0,p.jsx)(S.default,{contentContainerStyle:R.scrollContainer,keyboardShouldPersistTaps:"handled",keyboardDismissMode:"on-drag",children:(0,p.jsx)(s.default,{style:R.modalOverlay,children:(0,p.jsxs)(s.default,{style:R.modalContent,children:[(0,p.jsx)(d.default,{style:R.modalTitle,children:"Neue Buchung"}),(0,p.jsxs)(d.default,{children:["Check-In: ",t]}),(0,p.jsxs)(d.default,{children:["Check-Out: ",n]}),(0,p.jsx)(d.default,{style:R.label,children:"Gastname:"}),(0,p.jsx)(u.default,{style:R.input,placeholder:"Vorname Nachname",value:g,onChangeText:m,returnKeyType:"done",onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:R.label,children:"Personenanzahl:"}),(0,p.jsx)(u.default,{style:R.input,placeholder:"z. B. 2",value:x,onChangeText:y,keyboardType:"numeric",returnKeyType:"done",onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:R.label,children:"Status:"}),(0,p.jsx)(E,{options:N,selectedValue:j,onChange:k}),(0,p.jsx)(d.default,{style:R.label,children:"Anzahlung:"}),(0,p.jsx)(u.default,{style:R.input,placeholder:"0",value:C,onChangeText:v,keyboardType:"numeric",returnKeyType:"done",onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:R.label,children:"Verpflegung:"}),(0,p.jsx)(E,{options:A,selectedValue:w,onChange:_}),(0,p.jsx)(d.default,{style:R.label,children:"Preis pro Person:"}),(0,p.jsx)(u.default,{style:R.input,placeholder:"z. B. 50",value:B,onChangeText:T,keyboardType:"numeric",returnKeyType:"done",onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:R.label,children:"Hund:"}),(0,p.jsx)(E,{options:M,selectedValue:D,onChange:F}),(0,p.jsx)(d.default,{style:R.label,children:"Zusatz Preis:"}),(0,p.jsx)(u.default,{style:R.input,placeholder:"z. B. 10",value:I,onChangeText:$,returnKeyType:"done",onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:R.label,children:"Tel.: / email:"}),(0,p.jsx)(u.default,{style:R.input,placeholder:"Telefon oder Email",value:L,onChangeText:W,returnKeyType:"done",onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:R.label,children:"Notiz:"}),(0,p.jsx)(u.default,{style:[R.input,{height:80}],placeholder:"Notiz",value:Y,onChangeText:V,multiline:!0,returnKeyType:"done"}),(0,p.jsxs)(s.default,{style:R.buttonRow,children:[(0,p.jsx)(c.default,{title:"Abbrechen",onPress:a}),""!==t.trim()&&""!==n.trim()&&(0,p.jsx)(c.default,{title:"Buchung erstellen",disabled:!G||H,onPress:U})]})]})})});return(0,p.jsx)(z.default,{isVisible:e,onBackdropPress:a,coverScreen:!0,useNativeDriver:!1,style:R.modalContainer,propagateSwipe:!0,avoidKeyboard:!0,children:K})}));function L(e,t){window.alert(`${e}: ${t}`)}const W=(0,r.memo)((({options:e,selectedValue:t,onChange:n})=>(0,p.jsx)(s.default,{style:V.radioGroup,children:e.map((e=>{const a=e.value===t;return(0,p.jsx)(I.default,{onPress:()=>n(e.value),children:(0,p.jsx)(s.default,{style:[V.radioOption,a&&V.radioOptionSelected],children:(0,p.jsx)(d.default,{style:[V.radioLabel,a&&V.radioLabelSelected],children:e.label})})},e.value)}))}))),Y={height:40,fontSize:16,paddingVertical:8,paddingHorizontal:10,borderWidth:1,borderColor:"#ccc",borderRadius:4,color:"black",marginBottom:12,width:"100%"},V=h.default.create({modalContainer:{margin:0,justifyContent:"flex-end"},scrollContainer:{flexGrow:1,justifyContent:"center"},modalOverlay:{flexGrow:1,backgroundColor:"rgba(0,0,0,0.5)",padding:16,justifyContent:"center"},modalContent:{backgroundColor:"#fff",borderRadius:8,padding:16,width:"85%",alignSelf:"center"},modalTitle:{fontSize:18,fontWeight:"bold",marginBottom:12,textAlign:"center"},label:{marginTop:8,fontWeight:"600",marginBottom:4,fontSize:16},radioGroup:{flexDirection:"row",marginBottom:12},radioOption:{paddingVertical:4,paddingHorizontal:8,borderWidth:1,borderColor:"#ccc",borderRadius:4,marginRight:8},radioOptionSelected:{backgroundColor:"#007AFF",borderColor:"#007AFF"},radioLabel:{fontSize:16,color:"black"},radioLabelSelected:{color:"#fff"},buttonRow:{flexDirection:"row",justifyContent:"space-around",marginTop:12},modalButtons:{marginTop:12,alignItems:"center"}}),H=(0,r.memo)((({isVisible:e,booking:t,onClose:n,onUpdate:a,onDelete:l,onRefresh:o})=>{const[i,h]=(0,r.useState)(t.guestName),[f,g]=(0,r.useState)(t.personCount.toString()),[m,x]=(0,r.useState)(t.status),[y,j]=(0,r.useState)(t.anzahlung.toString()),[k,C]=(0,r.useState)(t.verpflegung||"Fr\xfchst\xfcck"),[v,w]=(0,r.useState)(null!==t.preisProPerson?t.preisProPerson.toString():""),[_,B]=(0,r.useState)(t.hund?"ja":"nein"),[T,D]=(0,r.useState)(t.zusatz_preis),[F,I]=(0,r.useState)(t.tel_email),[O,E]=(0,r.useState)(t.roomNumber),[N,A]=(0,r.useState)(t.checkIn),[M,R]=(0,r.useState)(t.checkOut),[$,H]=(0,r.useState)(t.notiz||""),[Z,G]=(0,r.useState)(!1);(0,r.useEffect)((()=>{h(t.guestName),g(t.personCount.toString()),x(t.status),j(t.anzahlung.toString()),C(t.verpflegung||"Fr\xfchst\xfcck"),w(null!==t.preisProPerson?t.preisProPerson.toString():""),B(t.hund?"ja":"nein"),D(t.zusatz_preis),I(t.tel_email),E(t.roomNumber),A(t.checkIn),R(t.checkOut),H(t.notiz||""),G(!1)}),[t]);const q=i.trim().split(" ").length>=2&&!isNaN(parseInt(f))&&parseInt(f)>0&&""!==N.trim()&&""!==M.trim()&&""!==O.trim(),U=(0,r.useCallback)((async e=>{const{data:t,error:n}=await b.from("zimmer").select("id").eq("nummer",e).single();return n||!t?(L("Fehler","Zimmer mit dieser Nummer wurde nicht gefunden."),null):t.id}),[]),K=(0,r.useCallback)((async(e,n,a)=>{const{data:r,error:l}=await b.from("buchungen").select("id").eq("zimmer_id",e).not("id","eq",t.id).filter("check_in","lt",a).filter("check_out","gt",n);return l?(L("Fehler","Fehler bei der Verf\xfcgbarkeitspr\xfcfung."),!1):r&&0===r.length}),[t.id]),J=(0,r.useCallback)((async()=>{if(Z)return;const e=parseInt(f);if(isNaN(e)||e<=0)return void L("Fehler","Bitte eine g\xfcltige Anzahl an Personen eingeben.");G(!0);const a=parseFloat(y),r=""===v.trim()?null:parseFloat(v),l=O.trim();if(!l)return L("Fehler","Bitte eine Zimmernummer angeben."),void G(!1);const i=await U(l);if(!i)return void G(!1);if(!await K(i,N,M))return L("Fehler","Das Zimmer ist im angegebenen Zeitraum nicht verf\xfcgbar."),void G(!1);const{error:s}=await b.from("buchungen").update({zimmer_id:i,check_in:N,check_out:M,anzahl_personen:e,preis_pro_person:r??0,anzahlung:isNaN(a)?0:a,status:m,verpflegung:k,hund:"ja"===_,zusatz_preis:T,tel_email:F,notiz:$}).eq("id",t.id);s?L("Fehler",s.message):(L("Erfolg","Buchung aktualisiert!"),o&&await o(),n()),G(!1)}),[Z,f,y,v,O,N,M,m,k,_,T,F,$,t.id,U,K,o,n]),X=(0,r.useCallback)((async()=>{if(Z)return;if(await Promise.resolve(window.confirm("M\xf6chtest du die Buchung wirklich l\xf6schen?"))){G(!0);const{error:e}=await b.from("buchungen").delete().eq("id",t.id);e?L("Fehler",e.message):(L("Erfolg","Buchung gel\xf6scht!"),o&&await o(),n()),G(!1)}}),[Z,t.id,o,n]),Q=(0,p.jsx)(S.default,{contentContainerStyle:V.scrollContainer,keyboardShouldPersistTaps:"handled",keyboardDismissMode:"on-drag",children:(0,p.jsx)(s.default,{style:V.modalOverlay,children:(0,p.jsxs)(s.default,{style:V.modalContent,children:[(0,p.jsx)(d.default,{style:V.modalTitle,children:"Buchung bearbeiten"}),(0,p.jsxs)(d.default,{children:["Aktueller Check-In: ",t.checkIn]}),(0,p.jsxs)(d.default,{children:["Aktueller Check-Out: ",t.checkOut]}),(0,p.jsx)(d.default,{style:V.label,children:"Zimmernummer:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 101",value:O,onChangeText:E,blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Neuer Check-In:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"YYYY-MM-DD",value:N,onChangeText:A,blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Neuer Check-Out:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"YYYY-MM-DD",value:M,onChangeText:R,blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Gastname:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"Vorname Nachname",value:i,onChangeText:h,blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Anzahl Personen:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 2",value:f,onChangeText:g,keyboardType:"numeric",blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Status:"}),(0,p.jsx)(W,{options:[{label:"Belegt",value:"belegt"},{label:"Anzahlung",value:"anzahlung"},{label:"Anz. bez",value:"anzahlung_bezahlt"}],selectedValue:m,onChange:x}),(0,p.jsx)(d.default,{style:V.label,children:"Anzahlung:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"0",value:y,onChangeText:j,keyboardType:"numeric",blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Verpflegung:"}),(0,p.jsx)(W,{options:[{label:"Fr\xfchst\xfcck",value:"Fr\xfchst\xfcck"},{label:"Halbpension",value:"Halbpension"}],selectedValue:k,onChange:C}),(0,p.jsx)(d.default,{style:V.label,children:"Preis pro Person:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 50",value:v,onChangeText:w,keyboardType:"numeric",blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Hund:"}),(0,p.jsx)(W,{options:[{label:"Nein",value:"nein"},{label:"Ja",value:"ja"}],selectedValue:_,onChange:B}),(0,p.jsx)(d.default,{style:V.label,children:"Zusatz Preis:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"z. B. 10",value:T,onChangeText:D,blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Tel.: / email:"}),(0,p.jsx)(u.default,{style:Y,placeholder:"Telefon oder Email",value:F,onChangeText:I,blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsx)(d.default,{style:V.label,children:"Notiz:"}),(0,p.jsx)(u.default,{style:[Y,{height:80}],placeholder:"Notiz",value:$,onChangeText:H,multiline:!0,blurOnSubmit:!0,onSubmitEditing:P.default.dismiss}),(0,p.jsxs)(s.default,{style:V.buttonRow,children:[(0,p.jsx)(c.default,{title:"Aktualisieren",disabled:!q||Z,onPress:J}),(0,p.jsx)(c.default,{title:"L\xf6schen",color:"red",onPress:X,disabled:Z})]}),(0,p.jsx)(s.default,{style:V.modalButtons,children:(0,p.jsx)(c.default,{title:"Schlie\xdfen",onPress:n,disabled:Z})})]})})});return(0,p.jsx)(z.default,{isVisible:e,onBackdropPress:n,coverScreen:!0,useNativeDriver:!1,style:V.modalContainer,propagateSwipe:!0,avoidKeyboard:!0,children:Q})})),Z=60;function G(e){return e.includes("T")?new Date(e):new Date(e+"T00:00:00")}function q(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function U(e,t){return t.findIndex((t=>q(t.date,e)))}function K(e){const t=e.getDate().toString().padStart(2,"0"),n=e.toLocaleDateString("de-DE",{month:"2-digit",year:"numeric"}).replace(".","/");return{date:new Date(e),dayNumber:t,monthYear:n}}function J(e,t,n,a){if(!e)return!1;if(t.getTime()===n.getTime())return!0;for(const r of a){if(r.zimmer_id!==e)continue;const a=G(r.check_in),l=G(r.check_out);if(t<l&&n>a){if(n.getTime()===a.getTime()||t.getTime()===l.getTime())continue;return!1}}return!0}function X(e,t,n){return n.find((n=>{if(n.zimmer_id!==t)return!1;const a=G(n.check_in),r=G(n.check_out);return e.date>=a&&e.date<=r}))||null}const Q=r.memo((({day:e,isSelected:t,existingBooking:n,onPress:a})=>(0,p.jsx)(v.default,{style:[ne.dayCell,{width:Z,height:35},n&&{backgroundColor:"transparent"},t&&ne.selectedDayCell],onPress:a,children:(0,p.jsx)(d.default,{style:ne.dayCellText,children:e.dayNumber})}))),ee=r.memo((e=>{const{room:t,bookings:n,daysArray:a,gaeste:r,onPressBooking:l}=e;return(0,p.jsx)(s.default,{style:ne.overlayContainer,children:n.map((e=>{const t=G(e.check_in),n=G(e.check_out),o=U(t,a),i=U(n,a);if(o<0||i<0)return null;let u=o*Z,c=(i-o+1)*Z;o===i?(u+=30,c=30):(u+=30,c-=Z);const h=r.find((t=>t.id===e.gast_id)),f=h?`${h.vorname} ${h.nachname}`:"Unbekannt";let g="";"Fr\xfchst\xfcck"===e.verpflegung?g="B&B":"Halbpension"===e.verpflegung?g="HP":e.verpflegung&&(g=e.verpflegung);const m=`${f} (${e.anzahl_personen}P) ${g}`;let b="#ccffcc";return"belegt"===e.status?b="#ffcccc":"anzahlung"===e.status?b="#ffffcc":"booking"===e.status&&(b="#ccccff"),(0,p.jsx)(v.default,{activeOpacity:.8,onPress:()=>l(e),children:(0,p.jsx)(s.default,{style:[ne.bookingBlock,{left:u,width:c,backgroundColor:b}],children:(0,p.jsx)(d.default,{style:ne.bookingBlockText,numberOfLines:2,children:m})})},e.id)}))})}));function te({buchungen:e,onRefresh:t}){const[n,a]=(0,r.useState)(e),[l,o]=(0,r.useState)(10),[i,h]=(0,r.useState)(6),[f,g]=(0,r.useState)([]),[x,y]=(0,r.useState)([]),[k,C]=(0,r.useState)(null),[z,w]=(0,r.useState)(null),[_,B]=(0,r.useState)(null),[T,D]=(0,r.useState)(!1),[P,I]=(0,r.useState)(!1),[O,E]=(0,r.useState)(null),[N,A]=(0,r.useState)(""),[M,R]=(0,r.useState)(""),[L,W]=(0,r.useState)(""),[Y,V]=(0,r.useState)(new Date),te=(0,r.useRef)(null),ae=(0,r.useRef)(0),re=(0,r.useMemo)((()=>function(e,t){const n=new Date;n.setDate(n.getDate()-e);const a=new Date;a.setMonth(a.getMonth()+t);const r=[];let l=new Date(n);for(;l<=a;)r.push(K(l)),l.setDate(l.getDate()+1);return r}(l,i)),[l,i]),le=(0,r.useCallback)((async()=>{try{const{data:e}=await b.from("zimmer").select("*");e&&g(e);const{data:t}=await b.from("gaeste").select("*");t&&y(t)}catch(e){console.error("Fehler beim Laden von Zimmern/G\xe4sten:",e)}}),[]);(0,r.useEffect)((()=>{le();const e=setInterval(le,12e4);return()=>clearInterval(e)}),[le]),(0,r.useEffect)((()=>{a(e)}),[e]),(0,m.useFocusEffect)((0,r.useCallback)((()=>{const e=Date.now();e-ae.current>3e4&&(t(),ae.current=e)}),[t]));const oe=(0,r.useCallback)((e=>{const t=e.nativeEvent.contentOffset.x+e.nativeEvent.layoutMeasurement.width/2,n=Math.floor(t/Z);if(n>=0&&n<re.length){const e=re[n].date;e.getMonth()===Y.getMonth()&&e.getFullYear()===Y.getFullYear()||V(e)}}),[re,Y]),ie=(0,r.useCallback)((e=>{if(0===re.length||!te.current)return;const t=re.findIndex((t=>t.date.getFullYear()===e.getFullYear()&&t.date.getMonth()===e.getMonth()));if(-1!==t){const e=80+t*Z;te.current.scrollTo({x:e,animated:!0})}}),[re]),se=(0,r.useCallback)((e=>{const t=Y.getFullYear(),n=new Date(t,e,1);V(n),ie(n)}),[Y,ie]),de=(0,r.useCallback)((()=>o((e=>e+90))),[]),ue=(0,r.useCallback)((()=>h((e=>e+3))),[]),ce=(0,r.useCallback)(((e,t)=>{if(!k){if(!J(t,e.date,e.date,n))return;return B(t),C(e),void w(e)}if(_!==t){if(!J(t,e.date,e.date,n))return;return B(t),C(e),void w(e)}if(q(e.date,k.date))w(e);else{if(e.date>=k.date){const a=J(t,k.date,e.date,n),r=X(e,t,n);return a||r&&q(e.date,G(r.check_in))?void w(e):void F.default.alert("Das Intervall ist nicht verf\xfcgbar.")}C(e),w(e)}}),[k,n,_]),he=(0,r.useCallback)((()=>{if(!L.trim())return;const e=L.toLowerCase(),t=n.find((t=>{const n=x.find((e=>e.id===t.gast_id));if(!n)return!1;return`${n.vorname} ${n.nachname}`.toLowerCase().includes(e)}));if(t){const e=U(G(t.check_in),re);if(-1!==e&&te.current){const t=80+e*Z;te.current.scrollTo({x:t,animated:!0})}}}),[L,n,x,re]),fe=(0,r.useCallback)((()=>{k&&z&&null!==_?D(!0):F.default.alert("Bitte Check\u2011In und Check\u2011Out ausw\xe4hlen.")}),[k,z,_]),ge=(0,r.useCallback)((e=>{const t=x.find((t=>t.id===e.gast_id)),n={id:e.id,zimmer_id:e.zimmer_id,guestName:t?`${t.vorname} ${t.nachname}`:"Unbekannt",personCount:e.anzahl_personen,checkIn:e.check_in,checkOut:e.check_out,status:e.status,anzahlung:e.anzahlung,verpflegung:e.verpflegung||"",preisProPerson:e.preis_pro_person,hund:e.hund||!1,zusatz_preis:e.zusatz_preis,tel_email:e.tel_email,notiz:e.notiz||"",roomNumber:f.find((t=>t.id===e.zimmer_id))?.nummer||""};E(n),I(!0)}),[x,f]),me=(0,r.useCallback)((async e=>{if(!k||!z||null===_)return void F.default.alert("Fehler","Bitte Check\u2011In, Check\u2011Out und Zimmer ausw\xe4hlen.");const n=k.date.toISOString().split("T")[0],a=z.date.toISOString().split("T")[0],r=e.guestName.trim().split(" ");if(r.length<2)return void F.default.alert("Fehler","Bitte Vor\u2011 und Nachname eingeben.");let l=null;const{data:o}=await b.from("gaeste").select("id").eq("vorname",r[0]).eq("nachname",r[1]);if(o&&o.length>0)l=o[0].id;else{const{data:e}=await b.from("gaeste").insert([{vorname:r[0],nachname:r[1]}]).select("*").single();if(!e)return void F.default.alert("Fehler","Gast konnte nicht erstellt werden.");l=e.id}const{error:i}=await b.from("buchungen").insert([{zimmer_id:_,gast_id:l,check_in:n,check_out:a,anzahl_personen:e.personCount,preis_pro_person:e.preisProPerson??0,anzahlung:e.anzahlung,status:e.status,verpflegung:e.verpflegung,hund:e.hund,zusatz_preis:e.zusatzPreis,tel_email:e.tel_email,notiz:e.notiz}]);i?F.default.alert("Fehler",i.message):(F.default.alert("Erfolg","Buchung erstellt!"),B(null),C(null),w(null),await t(),await le())}),[k,z,_,t,le]),be=(0,r.useCallback)((async e=>{await t(),await le(),I(!1),E(null)}),[t,le]),xe=(0,r.useCallback)((async e=>{await t(),await le(),I(!1),E(null)}),[t,le]);return(0,p.jsxs)(s.default,{style:ne.container,children:[(0,p.jsx)(j,{}),(0,p.jsx)(d.default,{style:ne.title,children:"Zimmer-Kalender"}),(0,p.jsx)(s.default,{style:ne.monthYearContainer,children:(0,p.jsx)(s.default,{style:{flex:1,alignItems:"center"},children:(0,p.jsx)(d.default,{style:ne.monthYearText,children:Y.toLocaleDateString("de-DE",{month:"long",year:"numeric"})})})}),(0,p.jsxs)(s.default,{style:ne.extensionButtonsContainer,children:[(0,p.jsx)(c.default,{title:"-3 Monate",onPress:de}),(0,p.jsx)(c.default,{title:"+3 Monate",onPress:ue})]}),(0,p.jsxs)(s.default,{style:ne.tableContainer,children:[(0,p.jsxs)(s.default,{style:ne.fixedColumn,children:[(0,p.jsx)(s.default,{style:[ne.headerCell,ne.leftHeaderCell],children:(0,p.jsx)(d.default,{style:ne.headerText,children:"Zimmer"})}),f.map((e=>(0,p.jsx)(s.default,{style:ne.roomCell,children:(0,p.jsxs)(d.default,{style:ne.roomText,children:["Z. ",e.nummer]})},e.id)))]}),(0,p.jsx)(S.default,{horizontal:!0,style:ne.horizontalScroll,ref:te,onScroll:oe,scrollEventThrottle:16,children:(0,p.jsxs)(s.default,{children:[(0,p.jsx)(s.default,{style:ne.headerRow,children:re.map((e=>{const t=q(e.date,new Date),n=e.date.toLocaleDateString("de-DE",{weekday:"short"}),a=n.startsWith("Sa")||n.startsWith("So");return(0,p.jsxs)(s.default,{style:[ne.headerCell,{width:Z},t&&ne.todayHeader,a&&ne.weekendHeader],children:[(0,p.jsxs)(d.default,{style:ne.headerSmallText,children:[n," ",e.monthYear]}),(0,p.jsx)(d.default,{style:ne.headerText,children:e.dayNumber})]},e.date.toISOString())}))}),f.map((e=>(0,p.jsxs)(s.default,{style:{position:"relative",height:35},children:[(0,p.jsx)(s.default,{style:ne.roomRow,children:re.map((t=>{const a=_===e.id&&(k&&q(t.date,k.date)||z&&q(t.date,z.date)),r=X(t,e.id,n);return(0,p.jsx)(Q,{day:t,isSelected:a,existingBooking:r,onPress:()=>{const n=r?G(r.check_in):null;k?r&&!q(t.date,n)||ce(t,e.id):r||ce(t,e.id)}},t.date.toISOString())}))}),(0,p.jsx)(ee,{room:e,bookings:n.filter((t=>t.zimmer_id===e.id)),daysArray:re,gaeste:x,onPressBooking:ge})]},e.id)))]})})]}),(0,p.jsx)(s.default,{style:ne.monthButtonsContainer,children:["Jan","Feb","M\xe4r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"].map(((e,t)=>(0,p.jsx)(v.default,{style:ne.monthButton,onPress:()=>se(t),children:(0,p.jsx)(d.default,{style:ne.monthButtonText,children:e})},t)))}),(0,p.jsxs)(s.default,{style:ne.searchContainer,children:[(0,p.jsx)(u.default,{style:ne.searchInput,placeholder:"Nach Gastname suchen...",value:L,onChangeText:W}),(0,p.jsx)(c.default,{title:"Suchen",onPress:he})]}),k&&z&&(0,p.jsx)(v.default,{style:ne.bookingButton,onPress:fe,children:(0,p.jsx)(d.default,{style:ne.bookingButtonText,children:"Buchungsformular \xf6ffnen"})}),(0,p.jsx)($,{isVisible:T,checkIn:k?k.date.toISOString().split("T")[0]:"",checkOut:z?z.date.toISOString().split("T")[0]:"",onClose:()=>D(!1),onSubmit:me,initialGuestName:N,initialPersonCount:M?parseInt(M):0,onRefresh:t,selectedRoomId:_||void 0}),O&&(0,p.jsx)(H,{isVisible:P,booking:O,onClose:()=>{I(!1),E(null)},onUpdate:be,onDelete:xe,onRefresh:t})]})}const ne=h.default.create({container:{flex:1,backgroundColor:"#fff",paddingTop:40},title:{fontSize:24,textAlign:"center",marginBottom:16},monthYearContainer:{flexDirection:"row",alignItems:"center",marginBottom:8,paddingHorizontal:16},monthYearText:{fontSize:20,fontWeight:"bold"},extensionButtonsContainer:{flexDirection:"row",justifyContent:"space-around",marginBottom:8,paddingHorizontal:16},tableContainer:{flexDirection:"row",flex:1},fixedColumn:{width:80},horizontalScroll:{flex:1},headerRow:{flexDirection:"row",borderBottomWidth:1,borderColor:"#ccc"},headerCell:{backgroundColor:"#eee",borderRightWidth:1,borderBottomWidth:1,borderColor:"#ccc",justifyContent:"center",alignItems:"center",height:35},headerText:{fontWeight:"bold",fontSize:12},headerSmallText:{fontSize:10,color:"#555"},leftHeaderCell:{borderBottomWidth:1,borderColor:"#ccc"},todayHeader:{backgroundColor:"#b3e6ff"},weekendHeader:{backgroundColor:"#cccccc"},roomRow:{flexDirection:"row"},roomCell:{backgroundColor:"#fafafa",borderBottomWidth:1,borderColor:"#ccc",justifyContent:"center",alignItems:"center",height:35,width:80},roomText:{fontSize:12},dayCell:{borderRightWidth:1,borderBottomWidth:1,borderColor:"#ccc",justifyContent:"center",alignItems:"center"},selectedDayCell:{backgroundColor:"#d0f0ff"},dayCellText:{fontSize:10,color:"#333"},overlayContainer:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"box-none"},bookingBlock:{position:"absolute",top:0,height:35,borderWidth:1,borderColor:"#99cc99",justifyContent:"center",alignItems:"center",paddingHorizontal:2},bookingBlockText:{fontSize:9,fontWeight:"600",color:"#333",textAlign:"center",flexWrap:"wrap"},monthButtonsContainer:{flexDirection:"row",justifyContent:"space-around",marginVertical:8},monthButton:{backgroundColor:"#eee",paddingVertical:6,paddingHorizontal:10,borderRadius:4},monthButtonText:{fontSize:12,fontWeight:"500"},bookingButton:{backgroundColor:"#007AFF",padding:12,margin:16,borderRadius:6,alignItems:"center"},bookingButtonText:{color:"#fff",fontSize:16},searchContainer:{flexDirection:"row",alignItems:"center",padding:8},searchInput:{flex:1,borderWidth:1,borderColor:"#ccc",padding:8,borderRadius:4,marginRight:8}}),ae=h.default.create({container:{flex:1,padding:16,backgroundColor:"#fff"},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:16},searchInput:{borderWidth:1,borderColor:"#ccc",padding:8,marginBottom:16,borderRadius:4},sectionTitle:{fontSize:20,fontWeight:"bold",marginTop:16,marginBottom:8},card:{backgroundColor:"#f9f9f9",padding:12,borderRadius:6,marginBottom:12},boldText:{fontWeight:"bold"},radioGroup:{flexDirection:"row",marginTop:8},radioButton:{padding:8,borderWidth:1,borderColor:"#ccc",backgroundColor:"#f0f0f0",borderRadius:4,marginRight:8},radioButtonRed:{backgroundColor:"#FF5733",borderColor:"#FF5733"},radioButtonGreen:{backgroundColor:"#4CAF50",borderColor:"#4CAF50"},radioText:{fontSize:16,color:"#000"}}),re=({onRefresh:e})=>{const[t,n]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(""),c=async()=>{try{const e=(new Date).toISOString().split("T")[0],{data:t,error:a}=await b.from("buchungen").select("*").or("status.eq.anzahlung,status.eq.anzahlung_bezahlt").gte("check_in",e).order("check_in",{ascending:!0});if(a)throw a;t&&n(t);const{data:r,error:o}=await b.from("gaeste").select("*");if(o)throw o;r&&l(r)}catch(e){console.error("Fehler beim Laden der Daten:",e),F.default.alert("Fehler","Daten konnten nicht geladen werden.")}};(0,r.useEffect)((()=>{c();const e=setInterval(c,12e4);return()=>clearInterval(e)}),[]),(0,r.useEffect)((()=>{e&&e()}),[e]);const h=async(e,t)=>{try{const{error:n}=await b.from("buchungen").update({status:t}).eq("id",e);if(n)throw n;F.default.alert("Erfolg","Status erfolgreich ge\xe4ndert."),c()}catch(n){console.error("Fehler beim Aktualisieren des Status:",n),F.default.alert("Fehler","Status konnte nicht ge\xe4ndert werden.")}},f=o?t.filter((e=>{const t=a.find((t=>t.id===e.gast_id));if(!t)return!1;return`${t.vorname} ${t.nachname}`.toLowerCase().includes(o.toLowerCase())})):t,g=f.filter((e=>"anzahlung"===e.status&&new Date(e.check_in)>new Date)).reduce(((e,t)=>e+t.anzahlung),0),m=f.filter((e=>"anzahlung_bezahlt"===e.status&&new Date(e.check_out)>new Date)).reduce(((e,t)=>e+t.anzahlung),0);return(0,p.jsxs)(S.default,{style:ae.container,children:[(0,p.jsx)(j,{}),(0,p.jsx)(d.default,{style:ae.title,children:"Anzahlungen"}),(0,p.jsx)(u.default,{style:ae.searchInput,placeholder:"G\xe4ste suchen...",value:o,onChangeText:i}),(0,p.jsxs)(d.default,{style:ae.sectionTitle,children:["Offene Anzahlungen (",g," \u20ac)"]}),f.filter((e=>"anzahlung"===e.status)).map((e=>{const t=a.find((t=>t.id===e.gast_id));return(0,p.jsxs)(s.default,{style:ae.card,children:[(0,p.jsxs)(d.default,{children:[(0,p.jsx)(d.default,{style:ae.boldText,children:t?`${t.vorname} ${t.nachname}`:"Unbekannter Gast"})," - ",e.check_in," bis ",e.check_out]}),(0,p.jsxs)(d.default,{children:["Anzahlung: ",e.anzahlung," \u20ac"]}),(0,p.jsxs)(s.default,{style:ae.radioGroup,children:[(0,p.jsx)(v.default,{style:[ae.radioButton,"anzahlung"===e.status&&ae.radioButtonRed],onPress:()=>h(e.id,"anzahlung"),children:(0,p.jsx)(d.default,{style:ae.radioText,children:"Nicht bezahlt"})}),(0,p.jsx)(v.default,{style:[ae.radioButton,"anzahlung_bezahlt"===e.status&&ae.radioButtonGreen],onPress:()=>h(e.id,"anzahlung_bezahlt"),children:(0,p.jsx)(d.default,{style:ae.radioText,children:"Bezahlt"})})]})]},e.id)})),(0,p.jsxs)(d.default,{style:ae.sectionTitle,children:["Bezahlte Anzahlungen (",m," \u20ac)"]}),f.filter((e=>"anzahlung_bezahlt"===e.status)).map((e=>{const t=a.find((t=>t.id===e.gast_id));return(0,p.jsxs)(s.default,{style:ae.card,children:[(0,p.jsxs)(d.default,{children:[(0,p.jsx)(d.default,{style:ae.boldText,children:t?`${t.vorname} ${t.nachname}`:"Unbekannter Gast"})," - ",e.check_in," bis ",e.check_out]}),(0,p.jsxs)(d.default,{children:["Anzahlung: ",e.anzahlung," \u20ac"]}),(0,p.jsxs)(s.default,{style:ae.radioGroup,children:[(0,p.jsx)(v.default,{style:[ae.radioButton,"anzahlung"===e.status&&ae.radioButtonRed],onPress:()=>h(e.id,"anzahlung"),children:(0,p.jsx)(d.default,{style:ae.radioText,children:"Nicht bezahlt"})}),(0,p.jsx)(v.default,{style:[ae.radioButton,"anzahlung_bezahlt"===e.status&&ae.radioButtonGreen],onPress:()=>h(e.id,"anzahlung_bezahlt"),children:(0,p.jsx)(d.default,{style:ae.radioText,children:"Bezahlt"})})]})]},e.id)}))]})};var le=n(932),oe=n(8264);const ie=h.default.create({container:{flex:1,padding:20,justifyContent:"center"},title:{fontSize:24,fontWeight:"bold",textAlign:"center",marginBottom:24},section:{marginBottom:40},sectionTitle:{fontSize:18,fontWeight:"bold",marginBottom:12},input:{height:40,borderColor:"#ccc",borderWidth:1,borderRadius:4,paddingHorizontal:10,marginBottom:12},ferienItem:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:8},ferienButtons:{flexDirection:"row"},modalContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0,0,0,0.5)"},modalContent:{backgroundColor:"white",padding:20,borderRadius:10,width:"80%"}}),se=()=>{const[e,t]=(0,r.useState)(""),[n,a]=(0,r.useState)(""),[l,o]=(0,r.useState)([]),[i,h]=(0,r.useState)(!1),[f,x]=(0,r.useState)(null),[y,j]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),S=(0,m.useNavigation)(),v=async()=>{try{const e=(new Date).toISOString().split("T")[0],{data:t,error:n}=await b.from("buchungen").select("check_in, check_out").eq("status","Ferien").gt("check_out",e);if(n)throw n;if(t){const e={};t.forEach((t=>{const n=`${t.check_in}_${t.check_out}`;e[n]={check_in:t.check_in,check_out:t.check_out}})),o(Object.values(e))}}catch(e){F.default.alert("Fehler",e.message)}};(0,r.useEffect)((()=>{v()}),[]);return(0,p.jsxs)(s.default,{style:ie.container,children:[(0,p.jsx)(d.default,{style:ie.title,children:"Einstellungen"}),(0,p.jsxs)(s.default,{style:ie.section,children:[(0,p.jsx)(d.default,{style:ie.sectionTitle,children:"Ferien eintragen"}),(0,p.jsx)(u.default,{style:ie.input,placeholder:"Startdatum (YYYY-MM-DD)",value:e,onChangeText:t}),(0,p.jsx)(u.default,{style:ie.input,placeholder:"Enddatum (YYYY-MM-DD)",value:n,onChangeText:a}),(0,p.jsx)(c.default,{title:"Ferien eintragen",onPress:async()=>{if(e&&n)try{const{data:r,error:l}=await b.from("buchungen").select("zimmer_id").filter("check_in","lt",n).filter("check_out","gt",e);if(l)throw l;if(r&&r.length>0)return void F.default.alert("Nicht m\xf6glich","In mindestens einem Zimmer existiert bereits eine Buchung in diesem Zeitraum.");const{data:o,error:i}=await b.from("zimmer").select("id");if(i)throw i;if(!o||0===o.length)return void F.default.alert("Fehler","Keine Zimmer gefunden.");const{data:s}=await b.from("gaeste").select("id").eq("vorname","Ferien").eq("nachname","Ferien");let d;if(s&&s.length>0)d=s[0].id;else{const{data:e,error:t}=await b.from("gaeste").insert([{vorname:"Ferien",nachname:"Ferien"}]).select("*").single();if(t)throw t;d=e.id}const u=o.map((t=>({zimmer_id:t.id,gast_id:d,check_in:e,check_out:n,anzahl_personen:0,preis_pro_person:0,anzahlung:0,status:"Ferien",verpflegung:"",hund:!1,zusatz_preis:"",tel_email:"",notiz:"Ferienbuchung"}))),{error:c}=await b.from("buchungen").insert(u);if(c)throw c;F.default.alert("Erfolg","Ferien erstellt."),t(""),a(""),v()}catch(r){console.error(r),F.default.alert("Fehler",r.message)}else F.default.alert("Fehler","Bitte Start- und Enddatum angeben.")}})]}),(0,p.jsxs)(s.default,{style:ie.section,children:[(0,p.jsx)(d.default,{style:ie.sectionTitle,children:"Bevorstehende Ferien"}),(0,p.jsx)(le.default,{data:l,keyExtractor:e=>e.check_in+"_"+e.check_out,renderItem:({item:e})=>(0,p.jsxs)(s.default,{style:ie.ferienItem,children:[(0,p.jsxs)(d.default,{children:[e.check_in," bis ",e.check_out]}),(0,p.jsxs)(s.default,{style:ie.ferienButtons,children:[(0,p.jsx)(c.default,{title:"Bearbeiten",onPress:()=>{x(e),j(e.check_in),C(e.check_out),h(!0)}}),(0,p.jsx)(c.default,{title:"L\xf6schen",onPress:()=>(async(e,t)=>{try{const{error:n}=await b.from("buchungen").delete().eq("status","Ferien").eq("check_in",e).eq("check_out",t);if(n)throw n;F.default.alert("Erfolg","Ferien gel\xf6scht."),v()}catch(n){F.default.alert("Fehler",n.message)}})(e.check_in,e.check_out),color:"red"})]})]}),ListEmptyComponent:(0,p.jsx)(d.default,{children:"Keine Ferien eingetragen."})})]}),(0,p.jsxs)(s.default,{style:ie.section,children:[(0,p.jsx)(d.default,{style:ie.sectionTitle,children:"Logout"}),(0,p.jsx)(c.default,{title:"Logout",onPress:async()=>{try{await b.auth.signOut(),await g.default.clear(),S.reset({index:0,routes:[{name:"Login"}]})}catch(e){F.default.alert("Fehler",e.message||"Logout fehlgeschlagen.")}},color:"red"})]}),(0,p.jsx)(oe.default,{visible:i,animationType:"slide",transparent:!0,onRequestClose:()=>h(!1),children:(0,p.jsx)(s.default,{style:ie.modalContainer,children:(0,p.jsxs)(s.default,{style:ie.modalContent,children:[(0,p.jsx)(d.default,{children:"Ferien bearbeiten"}),(0,p.jsx)(u.default,{style:ie.input,placeholder:"Neues Startdatum (YYYY-MM-DD)",value:y,onChangeText:j}),(0,p.jsx)(u.default,{style:ie.input,placeholder:"Neues Enddatum (YYYY-MM-DD)",value:k,onChangeText:C}),(0,p.jsx)(c.default,{title:"Speichern",onPress:async()=>{if(y&&k&&f)try{const{error:e}=await b.from("buchungen").update({check_in:y,check_out:k}).eq("status","Ferien").eq("check_in",f.check_in).eq("check_out",f.check_out);if(e)throw e;F.default.alert("Erfolg","Ferien aktualisiert."),h(!1),x(null),v()}catch(e){F.default.alert("Fehler",e.message)}else F.default.alert("Fehler","Bitte neue Start- und Enddaten angeben.")}}),(0,p.jsx)(c.default,{title:"Abbrechen",onPress:()=>h(!1),color:"red"})]})})})]})},de=(0,o.createNativeStackNavigator)();(0,a.default)((function(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),o=(0,r.useCallback)((async()=>{if(n)try{console.log("\ud83d\udd04 Vollst\xe4ndiges Laden der Buchungen...");const{data:e,error:n}=await b.from("buchungen").select("*").is("deleted_at",null);if(n)return void console.error("\u274c Fehler beim Voll-Laden der Buchungen:",n);console.log("\ud83d\udce5 Vollst\xe4ndig geladene Buchungen:",e),e&&t(e)}catch(e){console.error("\u26a0\ufe0f Fehler in syncFullBuchungen:",e)}}),[n]);return(0,r.useEffect)((()=>{const e=i.default.addEventListener((e=>{a(e.isConnected)}));o();const t=setInterval(o,12e4);return()=>{clearInterval(t),e()}}),[o]),console.log("\ud83d\udcca Buchungen in App.tsx:",e),(0,p.jsx)(l.NavigationContainer,{children:(0,p.jsxs)(de.Navigator,{initialRouteName:"Login",children:[(0,p.jsx)(de.Screen,{name:"Login",component:k}),(0,p.jsx)(de.Screen,{name:"Home",component:D}),(0,p.jsx)(de.Screen,{name:"Calendarscreen",children:()=>(0,p.jsx)(te,{buchungen:e,onRefresh:o})}),(0,p.jsx)(de.Screen,{name:"AnzahlungenScreen",children:()=>(0,p.jsx)(re,{onRefresh:o})}),(0,p.jsx)(de.Screen,{name:"EinstellungenScreen",component:se})]})})}))},4082:(e,t,n)=>{e.exports=n.p+"static/media/logo.dd0213c004f3f047ac5b.png"},7635:(e,t,n)=>{e.exports=n.p+"static/media/LogoBetrieb.c5ef20b02b90bcffbb09.png"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.m=e,(()=>{var e=[];n.O=(t,a,r,l)=>{if(!a){var o=1/0;for(u=0;u<e.length;u++){for(var[a,r,l]=e[u],i=!0,s=0;s<a.length;s++)(!1&l||o>=l)&&Object.keys(n.O).every((e=>n.O[e](a[s])))?a.splice(s--,1):(i=!1,l<o&&(o=l));if(i){e.splice(u--,1);var d=r();void 0!==d&&(t=d)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,r,l]}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(a,r){if(1&r&&(a=this(a)),8&r)return a;if("object"===typeof a&&a){if(4&r&&a.__esModule)return a;if(16&r&&"function"===typeof a.then)return a}var l=Object.create(null);n.r(l);var o={};e=e||[null,t({}),t([]),t(t)];for(var i=2&r&&a;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>o[e]=()=>a[e]));return o.default=()=>a,n.d(l,o),l}})(),n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,a)=>(n.f[a](e,t),t)),[])),n.u=e=>"static/js/"+e+".783bc47a.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="web:";n.l=(a,r,l,o)=>{if(e[a])e[a].push(r);else{var i,s;if(void 0!==l)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==a||c.getAttribute("data-webpack")==t+l){i=c;break}}i||(s=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",t+l),i.src=a),e[a]=[r];var h=(t,n)=>{i.onerror=i.onload=null,clearTimeout(f);var r=e[a];if(delete e[a],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((e=>e(n))),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),s&&document.head.appendChild(i)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/Oberraut/",(()=>{var e={792:0};n.f.j=(t,a)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)a.push(r[2]);else{var l=new Promise(((n,a)=>r=e[t]=[n,a]));a.push(r[2]=l);var o=n.p+n.u(t),i=new Error;n.l(o,(a=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var l=a&&("load"===a.type?"missing":a.type),o=a&&a.target&&a.target.src;i.message="Loading chunk "+t+" failed.\n("+l+": "+o+")",i.name="ChunkLoadError",i.type=l,i.request=o,r[1](i)}}),"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,a)=>{var r,l,[o,i,s]=a,d=0;if(o.some((t=>0!==e[t]))){for(r in i)n.o(i,r)&&(n.m[r]=i[r]);if(s)var u=s(n)}for(t&&t(a);d<o.length;d++)l=o[d],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(u)},a=self.webpackChunkweb=self.webpackChunkweb||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=n.O(void 0,[624],(()=>n(211)));a=n.O(a)})();
//# sourceMappingURL=main.a486919d.js.map